(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{1272:function(t,e,a){},"130b":function(t,e,a){},"19bf":function(t,e,a){"use strict";a("d226")},"29ed":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"flex"},[a("q-scroll-area",{staticStyle:{"min-height":"100%","min-width":"100%"}},[a("optional-information"),a("verification-fields",{attrs:{loading:t.loading},on:{setLoading:t.setLoading}}),a("security"),a("library-key"),a("keychain")],1)],1)},i=[],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("setting-fragment",{attrs:{label:t.$t("account_personal_information")}},[a("q-form",{staticClass:"account-setting__information",on:{submit:function(e){return t.$refs.submitButton.handleButton(e)},reset:function(){t.edited=!1,t.fetchUser()}}},[t._l(t.form,(function(e,n,i){return["select"===e.type?a("Selector",{key:n,class:[i===Object.keys(t.form).length-1?"q-pb-xs":"q-pb-lg","full-width"],style:{minWidth:"280px"},attrs:{readonly:t.changing,value:e.model,options:e.options},on:{input:function(a){t.edited=!0,e.model=a}}}):a("q-input",{key:n,class:[i===Object.keys(t.form).length-1?"q-pb-xs":"q-pb-lg","full-width"],style:{minWidth:"280px"},attrs:{dense:"",outlined:"",readonly:t.changing,type:e.type,label:e.label,value:e.model,rules:e.rules,spellcheck:"false"},on:{input:function(a){t.edited=!0,e.model=a}},scopedSlots:t._u([{key:"prepend",fn:function(){return[e.icon?a("q-icon",{attrs:{name:e.icon}}):t._e()]},proxy:!0}],null,!0)})]})),a("div",{directives:[{name:"show",rawName:"v-show",value:t.edited,expression:"edited"}],staticClass:"optional-container q-mt-md"},[a("q-btn",{ref:"submitButton",staticStyle:{"min-width":"128px"},attrs:{unelevated:"",disable:t.changing||!t.fieldsValid,loading:t.changing,label:t.$t("account_submit"),type:"submit",color:"primary","text-color":"primary"},on:{click:t.handleSubmit}}),a("q-btn",{staticStyle:{"min-width":"128px"},attrs:{unelevated:"",disable:t.changing,label:t.$t("account_reset"),type:"reset",color:"general","text-color":"general"}})],1)],2)],1)},s=[],r=(a("ddb0"),a("48f4")),l=a("ed08"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:["setting-fragment"].concat(t.fragClz)},[a("div",{class:["setting-fragment__label"].concat(t.fragLabelClz)},[a("div",[t._v(t._s(t.label))]),t._t("label")],2),a("div",{class:["setting-fragment__content"].concat(t.fragContentClz)},[t._t("default")],2)])},u=[],d={name:"SettingFragment",props:{label:String},data(){return{fragClz:[],fragLabelClz:["non-selectable","text-general","row","items-center"],fragContentClz:[]}}},h=d,p=(a("19bf"),a("2877")),m=Object(p["a"])(h,c,u,!1,null,null,null),_=m.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-select",t._g(t._b({attrs:{dense:"",outlined:"",behavior:"menu",readonly:t.readonly,options:t.filter?t.optionsArr.filter((function(e){return t.filter(e.value)})):t.optionsArr,"option-label":function(e){return t.filter?"":"not_say"===e.label?t.$t("account_not_say"):e.label},"menu-offset":[0,4],"menu-anchor":"bottom left","menu-self":"top start","transition-show":"jump-down","transition-hide":"jump-up"},scopedSlots:t._u([{key:"no-option",fn:function(){return[a("q-item",{staticClass:"non-selectable",style:t.noOptionStyle},[a("q-item-section",{staticClass:"text-grey"},[t._v("\n        No results\n      ")])],1)]},proxy:!0},t.model&&(t.model.icon||t.model.emoji)?{key:"prepend",fn:function(){return[t.model.icon?a("q-icon",{attrs:{name:t.model.icon}}):t.model.emoji?a("div",{style:t.emojiStyle},[t._v(t._s(t.model.emoji))]):t._e()]},proxy:!0}:null,{key:"option",fn:function(e){var n=e.itemProps,i=e.itemEvents,o=e.opt;return[a("q-item",t._g(t._b({staticClass:"overflow-hidden-x",style:t.optionStyle},"q-item",n,!1),i),[o.icon||o.emoji?a("q-item-section",{staticStyle:{"margin-left":"-4px","margin-right":"-22px"},attrs:{avatar:""}},[o.icon?a("q-icon",{attrs:{name:o.icon}}):o.emoji?a("div",{style:t.emojiStyle},[t._v(t._s(o.emoji))]):t._e()],1):t._e(),a("q-item-section",{staticStyle:{"margin-left":"-4px"}},[a("q-item-label",{domProps:{innerHTML:t._s("not_say"===o.label?t.$t("account_not_say"):o.label)}})],1)],1)]}}],null,!0),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}},"q-select",t.filterProps,!1),t.filterEvents))},g=[],f=a("839e");const v=(()=>{const t={TW:t=>{"TW"===t.country_code&&(t.emoji="🇼🇫")}},e=[];return Object.entries(f["countries"]).forEach((([a,n])=>{const i={country_code:a,name:n.name,name_native:n.native,emoji:n.emoji,phone_list:n.phone.split(","),language_list:n.languages};t.TW(i),e.push(i)})),e})(),y=v.map((t=>({id:t.country_code,country_code:t.country_code,name:t.name,name_native:t.name_native,emoji:t.emoji}))),w=y.reduce(((t,e)=>(t[e.id]=e,t)),{}),$={value:"not_say",label:"not_say",emoji:"🇼🇫"},C=(()=>{const t=Object.values(w).map((t=>({value:t.id,label:t.name_native,emoji:t.emoji})));return t.unshift($),t})(),k=t=>t===$.value?$:w[t],x={data(){return{emojiStyle:{fontFamily:"Noto Color Emoji",fontSize:"1.22rem",color:"#000"}}}},S={data(){const t={getInputEl:()=>this.$el,observer:new ResizeObserver((()=>{const t=this.mixin$OptionsStyle.getInputEl(),{width:e}=getComputedStyle(t);this.optionStyle={width:`calc(${e} - 8px)`},this.noOptionStyle={width:e}}))};return{mixin$OptionsStyle:t,optionStyle:{},noOptionStyle:{}}},mounted(){this.mixin$OptionsStyle.observer.observe(this.mixin$OptionsStyle.getInputEl())},beforeDestroy(){this.mixin$OptionsStyle.observer.unobserve(this.mixin$OptionsStyle.getInputEl())}},q={data(){return{isPopupShow:!1,filter:null}},computed:{filterProps(){return["locale"].includes(this.options)?{useInput:!0,inputDebounce:"0",inputStyle:this.isPopupShow?void 0:"display:none"}:{}},filterEvents(){return["locale"].includes(this.options)?{"popup-show":this.onPopupShow.bind(this),filter:this.onFilter.bind(this),"popup-hide":this.onPopupHide.bind(this)}:{}}},methods:{onFilter(t,e){e((()=>{this.filter=e=>{if(!t)return!0;if("not_say"===e)return!1;const a=k(e),n=[a.name,a.name_native,a.country_code];return n.some((e=>e.toLowerCase().includes(t.toLowerCase())))}}))},onPopupShow(){this.isPopupShow=!0,this.$nextTick((()=>{const t=this.$el.getElementsByTagName("input")[0];t.focus()}))},onPopupHide(){this.isPopupShow=!1,this.filter=null}}};var N={name:"Selector",mixins:[x,S,q],props:{value:String,options:[Array,String],readonly:Boolean},computed:{optionsArr(){const t=Object.assign([],"locale"===this.options?C:this.options);return t},model:{get(){return Object.assign({},this.optionsArr.find((t=>t.value===this.value)))},set(t){t&&this.$emit("input",t.value)}}}},D=N,O=(a("a2be"),a("ddd8")),L=a("66e5"),A=a("4074"),E=a("0016"),T=a("0170"),P=a("eebe"),M=a.n(P),j=Object(p["a"])(D,b,g,!1,null,null,null),I=j.exports;M()(j,"components",{QSelect:O["a"],QItem:L["a"],QItemSection:A["a"],QIcon:E["a"],QItemLabel:T["a"]});var Q=a("05e4"),U=function(){const t={};return t.nickname={type:"text",icon:"emoji_emotions",label:this.$t("account_nickname"),rules:[Q["b"].bind(this)],model:""},t.gender={type:"select",options:[{value:"not_say",icon:"elevator",label:this.$t("account_not_say")},{value:"female",icon:"female",label:this.$t("account_female")},{value:"male",icon:"male",label:this.$t("account_male")}],model:"not_say"},t.birthday={type:"date",icon:"cake",model:""},t.locale={type:"select",model:"not_say",options:"locale"},t},F={name:"OptionalInformation",components:{SettingFragment:_,Selector:I},data(){return{changing:!1,form:null,edited:!1}},created(){this.$watch("$store.getters.accountUserOptionalInfo",(()=>{this.fetchUser()}),{immediate:!0})},computed:{fieldsValid(){return!Object.values(this.form).some((t=>{if(t.rules)return t.rules.some((e=>!0!==e(t.model)))}))}},methods:{fetchUser(){const t=Object(l["deepClone"])(this.$store.getters.accountUserOptionalInfo),e=this.form||U.call(this);Object.entries(t).forEach((([t,a])=>{e[t]&&(e[t].model="notSay"===a?"not_say":a)})),this.form=e},async handleSubmit(){try{this.changing=!0,await this.$store.dispatch("ACCOUNT_CHANGE_ATTRIBUTES",Object.entries(this.form).reduce(((t,[e,a])=>(t[e]=a.model,t)),{})),r["a"].showPositive("changed"),this.edited=!1}catch(t){r["a"].showNegative(t.message)}finally{this.changing=!1}}}},B=F,z=(a("4f7a"),a("0378")),K=a("27f9"),R=a("9c40"),V=Object(p["a"])(B,o,s,!1,null,null,null),W=V.exports;M()(V,"components",{QForm:z["a"],QInput:K["a"],QIcon:E["a"],QBtn:R["a"]});var H=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("setting-fragment",{attrs:{label:t.$t("account_contact_information")}},[a("q-list",{staticClass:"account-setting__verification rounded-borders",attrs:{bordered:"",separator:""}},t._l(t.items,(function(e,n){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple",value:!t.loading,expression:"!loading"}],key:n,staticClass:"q-pa-md",attrs:{clickable:!t.loading,readonly:t.loading},on:{click:e.handleClick}},[a("q-item-section",{staticStyle:{"min-width":"unset"},attrs:{avatar:""}},[a("q-icon",{staticStyle:{opacity:"0.7"},attrs:{size:"1.75rem",name:e.icon}})],1),a("q-item-section",[a("q-item-label",[t._v(t._s(e.title))]),a("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.field||t.$t("account_not_set")))])],1),a("q-item-section",{attrs:{side:""}},[e.field&&e.verifiedLabel?a("q-badge",{attrs:{color:e.color,label:e.verifiedLabel}}):t._e()],1),a("q-tooltip",{attrs:{anchor:"center middle",self:"center middle","transition-show":"scale","transition-hide":"scale"}},[t._v("\n        "+t._s(e.verifiedLabel?t.$t("account_change"):t.$t("account_setting"))+"\n      ")])],1)})),1)],1)},G=[],Y=(a("5319"),a("d9e2"),a("8349")),J={name:"VerificationFields",components:{SettingFragment:_},props:{loading:Boolean},computed:{items(){const t=t=>t?"positive":"negative",e=t=>this.$t(t?"account_verified":"account_unverified"),a={title:this.$t("account_email"),icon:"email",field:this.$store.state.account.email,color:t(this.$store.state.account.emailVerified),verifiedLabel:e(this.$store.state.account.emailVerified),handleClick:this.handleClickEmail},n={title:this.$t("account_phone_number"),icon:"phone",field:this.$store.state.account.phoneNumber,color:t(this.$store.state.account.phoneNumberVerified),verifiedLabel:e(this.$store.state.account.phoneNumberVerified),handleClick:this.handleClickPhoneNumber};return[a,n]}},methods:{parsePhoneNumberModel(t,e){const a=Y["a"][e].phones.map((t=>t.replace("-"+e,""))).find((e=>t.startsWith("+"+e)));return t=t.substr(a.length+1),console.log({countryCode:e,prefixCode:a,phoneNumber:t}),{countryCode:e,prefixCode:a,phoneNumber:t}},getDefaultPrefix(){var t;const e=null!==(t=this.$q.lang.getLocale().toLowerCase())&&void 0!==t?t:"en-us",[a,n]=Y["b"][e].phones[0].split("-");return console.log({countryCode:n,prefixCode:a}),{countryCode:n,prefixCode:a}},async handleClickEmail(){const t=()=>{if(this.$store.state.account.identities.length>0)throw new Error("error_can_not_change_email_before_unbound_social_account");if("NOMFA"!==this.$store.state.account.preferredMFA)throw new Error("can_not_change_email_phone_with_mfa_enabled");if(!this.$store.state.account.phoneNumberVerified)throw new Error("can_not_change_email")};try{t()}catch(o){return void r["a"].showNegative(o.message)}const e=async t=>{const e=[t=>!!t||this.$t("account_is_required")],a={email:{type:"email",model:"",icon:"email",label:this.$t("account_email"),rules:e}};this.$store.state.account.email&&!this.$store.state.account.emailVerified&&(a.email.model=this.$store.state.account.email);const n=this.$alphabiz.dialog({title:this.$t("account_change_email"),prompts:a,cancel:!0,ok:{handler:()=>n.vm.dialog$useLoadingState("ok",(async e=>{const{prompts:a}=e.dialog$arguments();await t(e,a.email)}))}});await n.promise()},a=async t=>{const e=[t=>!!t||this.$t("account_is_required"),Q["g"].bind(this)],a={code:{type:"text",label:this.$t("account_verification_code"),icon:"shield",rules:e}},n=this.$alphabiz.dialog({title:this.$t("account_change_email"),prompts:a,cancel:!0,ok:{handler:()=>n.vm.dialog$useLoadingState("ok",(async e=>{const{prompts:a}=e.dialog$arguments();await t(e,a.code)}))}});await n.promise()},n=async t=>{try{if(t===this.$store.state.account.email&&this.$store.state.account.emailVerified)throw new Error("error_same_email");return await this.$store.dispatch("ACCOUNT_CHANGE_EMAIL_SEND",t),!0}catch(o){return r["a"].showNegative(o.message),!1}},i=async t=>{try{return await this.$store.dispatch("ACCOUNT_CHANGE_EMAIL_SUBMIT",t),!0}catch(o){return r["a"].showNegative(o.message),!1}};await e((async(t,e)=>{const o=await n(e);o&&await a((async(e,a)=>{const n=await i(a);n&&(r["a"].showPositive("changed"),e.hide(),t.hide())}))}))},async handleClickPhoneNumber(){const t=()=>{if("NOMFA"!==this.$store.state.account.preferredMFA)throw new Error("can_not_change_email_phone_with_mfa_enabled");if(!this.$store.state.account.emailVerified)throw new Error("can_not_change_phone")};try{t()}catch(o){return void r["a"].showNegative(o.message)}const e=async t=>{const e=[t=>!!t||this.$t("account_is_required"),Q["d"].bind(this)],a={phoneNumber:{type:"tel",model:{countryCode:null,prefixCode:null,phoneNumber:""},rules:e}};this.$store.state.account.phoneNumber&&!this.$store.state.account.phoneNumberVerified?Object.assign(a.phoneNumber.model,this.parsePhoneNumberModel(this.$store.state.account.phoneNumber,this.$store.state.account.phoneNumberCountryCode)):Object.assign(a.phoneNumber.model,this.getDefaultPrefix());const n=this.$alphabiz.dialog({title:this.$t("account_change_phone_number"),cancel:!0,prompts:a,ok:{handler:()=>n.vm.dialog$useLoadingState("ok",(async e=>{const{prompts:a}=e.dialog$arguments();await t(e,a.phoneNumber)}))}});await n.promise()},a=async t=>{const e=[t=>!!t||this.$t("account_is_required"),Q["g"].bind(this)],a={type:"text",icon:"shield",label:this.$t("account_verification_code"),rules:e},n=this.$alphabiz.dialog({title:this.$t("account_change_phone_number"),prompts:{code:a},cancel:!0,ok:{handler:()=>n.vm.dialog$useLoadingState("ok",(async e=>{const{prompts:a}=e.dialog$arguments();await t(e,a.code)}))}})},n=async(t,e)=>{try{if(e===this.$store.state.account.phoneNumber&&this.$store.state.account.phoneNumberVerified)throw new Error("error_same_phone");return await this.$store.dispatch("ACCOUNT_CHANGE_PHONE_NUMBER_SEND",{phoneNumberCountryCode:t,phoneNumber:e}),!0}catch(o){return r["a"].showNegative(o.message),!1}},i=async t=>{try{return await this.$store.dispatch("ACCOUNT_CHANGE_PHONE_NUMBER_SUBMIT",t),!0}catch(o){return!1}};await e((async(t,{countryCode:e,prefixCode:o,phoneNumber:s})=>{const l=await n(e,`+${o}${s}`);l&&await a((async(e,a)=>{const n=await i(a);n&&(r["a"].showPositive("changed"),e.hide(),t.hide())}))}))}}},X=J,Z=(a("65fb"),a("1c1c")),tt=a("58a8"),et=a("05c0"),at=a("714f"),nt=Object(p["a"])(X,H,G,!1,null,"dbe90cb8",null),it=nt.exports;M()(nt,"components",{QList:Z["a"],QItem:L["a"],QItemSection:A["a"],QIcon:E["a"],QItemLabel:T["a"],QBadge:tt["a"],QTooltip:et["a"]}),M()(nt,"directives",{Ripple:at["a"]});var ot=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("setting-fragment",{attrs:{label:t.$t("account_security")}},[a("div",{staticClass:"account-setting__security"},[a("security-change-password"),a("security-m-f-a"),a("security-delete-account")],1)])},st=[],rt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-btn",{attrs:{"no-caps":"","no-wrap":"",unelevated:"",color:"general","text-color":"general",label:t.$t("account_change_password")},on:{click:t.changePassword}})},lt=[],ct={name:"SecurityChangePassword",methods:{async changePassword(){const t=async t=>{const e={required:t=>!!t||this.$t("account_is_required")},a={currentPassword:{type:"password",model:"",label:this.$t("account_current_password"),rules:[e.required]},newPassword:{type:"password",model:"",label:this.$t("account_new_password"),rules:[e.required,Q["c"].bind(this),t=>t!==a.currentPassword.model||this.$t("account_new_password_same")]},reEnterPassword:{type:"password",model:"",label:this.$t("account_re_enter_new_password"),rules:[e.required,t=>t===a.newPassword.model||this.$t("account_password_not_equal")]}},n=this.$alphabiz.dialog({title:this.$t("account_change_password"),cancel:!0,prompts:a,ok:{color:"primary",textColor:"primary",handler:()=>n.vm.dialog$useLoadingState("ok",(async()=>{const{prompts:e}=n.vm.dialog$arguments(),a=await t(e.currentPassword,e.newPassword);a&&n.vm.hide()}))}});await n.promise()};await t((async(t,e)=>{try{return await this.$store.dispatch("ACCOUNT_CHANGE_PASSWORD",{oldPassword:t,newPassword:e}),r["a"].showPositive("password_has_been_reset"),!0}catch(a){const t="Incorrect username or password."===a.message?"incorrect_original_password":a.message;r["a"].showNegative(t)}}))}}},ut=ct,dt=Object(p["a"])(ut,rt,lt,!1,null,null,null),ht=dt.exports;M()(dt,"components",{QBtn:R["a"]});var pt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("alphabiz-button",{attrs:{"no-caps":"",label:t.$t("account_set_mfa_type")},on:{click:t.handleClick}},[a("amplify-dialog",{attrs:{"max-width":"309px",title:t.$t("account_set_mfa_type"),"on-submit":t.setMfaType,"on-clear":function(){return t.mfaType=t.$store.state.account.preferredMFA}},scopedSlots:t._u([{key:"description",fn:function(){return[a("div",[t._v(t._s(t.$t("account_tip_config_mfa")))]),a("div",{staticClass:"q-pt-sm q-gutter-xs"},[t.mfaTypeOptions[0].disable?a("div",{staticClass:"normal-grey rounded-borders q-pa-md"},[t._v(t._s(t.$t("account_tip_can_not_enable_totp_mfa"))+"\n        ")]):t._e(),t.mfaTypeOptions[1].disable?a("div",{staticClass:"normal-grey rounded-borders q-pa-md"},[t._v(t._s(t.$t("account_tip_can_not_enable_sms_mfa"))+"\n        ")]):t._e()])]},proxy:!0},{key:"default",fn:function(e){var n=e.disable;return[a("q-option-group",{attrs:{type:"radio",disable:n,options:t.mfaTypeOptions},model:{value:t.mfaType,callback:function(e){t.mfaType=e},expression:"mfaType"}})]}}]),model:{value:t.showSetMfaTypeDialog,callback:function(e){t.showSetMfaTypeDialog=e},expression:"showSetMfaTypeDialog"}}),a("amplify-dialog",{attrs:{"max-width":"309px",title:t.$t("account_disable_mfa"),"on-submit":t.setNoMfa,"on-clear":t.onNoMfaClear},scopedSlots:t._u([{key:"description",fn:function(){return["SMS_MFA"===t.$store.state.account.preferredMFA?a("div",[t._v("\n        "+t._s(t.$t("account_phone_sent_tip"))+"\n        "),a("div",{staticClass:"inline-block normal-grey q-py-xs q-px-md rounded-borders"},[t._v("\n          "+t._s(t.$store.state.account.phoneNumber)+"\n        ")])]):a("div",[t._v(t._s(t.$t("account_tip_verify_totp")))])]},proxy:!0},{key:"default",fn:function(e){var n=e.disable;return["SMS_MFA"===t.$store.state.account.preferredMFA?t._l(t.smsForm.items,(function(e,i){return a("amplify-input",t._b({key:i,staticStyle:{"margin-bottom":"-20px"},attrs:{required:"",label:t.$t(e.bound.label),readonly:n},model:{value:e.model,callback:function(a){t.$set(e,"model",a)},expression:"item.model"}},"amplify-input",e.bound,!1))})):t._l(t.totpForm.items,(function(e,i){return a("amplify-input",t._b({key:i,staticStyle:{"margin-bottom":"-20px"},attrs:{required:"",label:t.$t(e.bound.label),readonly:n},model:{value:e.model,callback:function(a){t.$set(e,"model",a)},expression:"item.model"}},"amplify-input",e.bound,!1))}))]}}]),model:{value:t.showNoMfaDialog,callback:function(e){t.showNoMfaDialog=e},expression:"showNoMfaDialog"}}),a("amplify-dialog",{attrs:{"max-width":"309px",title:t.$t("account_sms_mfa"),"on-submit":t.setSmsMfa,"on-clear":t.onSmsClear},scopedSlots:t._u([{key:"description",fn:function(){return[t._v("\n      "+t._s(t.$t("account_phone_sent_tip"))+"\n      "),a("div",{staticClass:"inline-block normal-grey q-py-xs q-px-md rounded-borders"},[t._v("\n        "+t._s(t.$store.state.account.phoneNumber)+"\n      ")])]},proxy:!0},{key:"default",fn:function(e){var n=e.disable;return t._l(t.smsForm.items,(function(e,i){return a("amplify-input",t._b({key:i,attrs:{required:"",label:t.$t(e.bound.label),readonly:n},model:{value:e.model,callback:function(a){t.$set(e,"model",a)},expression:"item.model"}},"amplify-input",e.bound,!1))}))}}]),model:{value:t.showSmsDialog,callback:function(e){t.showSmsDialog=e},expression:"showSmsDialog"}}),a("amplify-dialog",{attrs:{"max-width":"309px",title:t.$t("account_totp_mfa"),"on-submit":t.setTotpMfa,"on-clear":t.onTotpClear},scopedSlots:t._u([{key:"description",fn:function(){return[a("ol",{staticClass:"q-ma-none q-pl-md"},[a("li",{directives:[{name:"show",rawName:"v-show",value:""!==t.totpSecretCode,expression:"totpSecretCode!==''"}]},[t._v(t._s(t.$t("account_tip_setup_totp")))]),a("li",[t._v(t._s(t.$t("account_tip_verify_totp")))])])]},proxy:!0},{key:"default",fn:function(e){var n=e.disable;return[a("div",{directives:[{name:"show",rawName:"v-show",value:""!==t.totpSecretCode,expression:"totpSecretCode!==''"}],staticClass:"q-mb-md"},[a("div",{staticClass:"qrcode q-mx-auto",on:{click:t.copyCode}},[a("canvas",{ref:"qrcode",staticClass:"full-width full-height"}),a("div",[t._v(t._s(t.$t("account_copy_code")))])])]),t._l(t.totpForm.items,(function(e,i){return a("amplify-input",t._b({key:i,staticStyle:{"margin-bottom":"-20px"},attrs:{required:"",label:t.$t(e.bound.label),readonly:n},model:{value:e.model,callback:function(a){t.$set(e,"model",a)},expression:"item.model"}},"amplify-input",e.bound,!1))})),a("p",{directives:[{name:"show",rawName:"v-show",value:""===t.totpSecretCode,expression:"totpSecretCode===''"}],staticClass:"q-mt-lg q-mb-none"},[t._v(t._s(t.$t("account_no_totp"))+"\n        "),a("a",{staticClass:"text-primary cursor-pointer hover-underline",attrs:{disable:n},on:{click:t.setupTotp}},[t._v("\n          "+t._s(t.$t("account_setup_totp"))+"\n        ")])])]}}]),model:{value:t.showTotpDialog,callback:function(e){t.showTotpDialog=e},expression:"showTotpDialog"}})],1)},mt=[],_t=a("ac0b"),bt=a("d055"),gt=a.n(bt),ft=a("5723"),vt={name:"SecurityMFA",data(){return{mfaType:this.$store.state.account.preferredMFA,showSetMfaTypeDialog:!1,showNoMfaDialog:!1,showSmsDialog:!1,showTotpDialog:!1,smsForm:new _t["a"]({code:new _t["b"]("",{icon:"shield",label:"account_verification_code",rules:[Q["g"].bind(this)]})}),totpForm:new _t["a"]({code:new _t["b"]("",{icon:"shield",label:"account_totp",rules:[Q["g"].bind(this)]})}),totpSecretCode:""}},computed:{mfaTypeOptions(){const t=!this.$store.state.account.email||!this.$store.state.account.phoneNumber||!this.$store.state.account.emailVerified||!this.$store.state.account.phoneNumberVerified,e=t;return[{label:this.$t("account_totp_mfa"),value:"SOFTWARE_TOKEN_MFA",disable:e},{label:`${this.$t("account_sms_mfa")} (${this.$t("account_not_recommend")})`,value:"SMS_MFA",disable:t},{label:this.$t("account_disable_mfa"),value:"NOMFA"}]}},methods:{handleClick(){const t=!this.$store.state.account.email||!this.$store.state.account.phoneNumber||!this.$store.state.account.emailVerified||!this.$store.state.account.phoneNumberVerified;t?r["a"].showNegative("error_can_not_enable_mfa"):this.showSetMfaTypeDialog=!0},onNoMfaClear(){this.onTotpClear(),this.onSmsClear()},onSmsClear(){this.smsForm.clearData()},onTotpClear(){this.totpSecretCode="",this.totpForm.clearData()},async setMfaType(){if(this.mfaType===this.$store.state.account.preferredMFA)return!0;try{"NOMFA"===this.mfaType?("SMS_MFA"===this.$store.state.account.preferredMFA&&await Object(ft["s"])("phone_number"),this.showNoMfaDialog=!0):"SMS_MFA"===this.mfaType?(await Object(ft["s"])("phone_number"),this.showSmsDialog=!0):"SOFTWARE_TOKEN_MFA"===this.mfaType&&(this.showTotpDialog=!0)}catch({message:t}){r["a"].showNegative(t)}},async setNoMfa(){try{return"SMS_MFA"===this.$store.state.account.preferredMFA?await Object(ft["u"])("phone_number",this.smsForm.formData.code):await Object(ft["q"])(this.totpForm.formData.code),await this.$store.dispatch("ACCOUNT_SET_MFA_TYPE",this.mfaType),r["a"].showPositive("changed"),!0}catch({message:t}){r["a"].showNegative(t)}},async setSmsMfa(){try{return await Object(ft["u"])("phone_number",this.smsForm.formData.code),await this.$store.dispatch("ACCOUNT_SET_MFA_TYPE",this.mfaType),r["a"].showPositive("changed"),!0}catch({message:t}){r["a"].showNegative(t)}},async setTotpMfa(){try{return await Object(ft["q"])(this.totpForm.formData.code),await this.$store.dispatch("ACCOUNT_SET_MFA_TYPE",this.mfaType),r["a"].showPositive("changed"),!0}catch({message:t}){r["a"].showNegative(t)}},async setupTotp(){this.totpSecretCode=await Object(ft["p"])(),this.$nextTick(this.renderQRCode)},async copyCode(){await navigator.clipboard.writeText(this.totpSecretCode),r["a"].showPositive("clipboard_with_code")},renderQRCode(){if(!this.totpSecretCode)return;const t=this.$refs.qrcode;if(!t)return;let e="Alphabiz Account Services",a=this.$store.state.account.emailVerified?this.$store.state.account.email:e;e=encodeURIComponent(e),a=encodeURIComponent(a).replace(".","%2E");const n=encodeURIComponent(this.totpSecretCode),i=`otpauth://totp/${e}:${a}?secret=${n}&issuer=${e}`;gt.a.toCanvas(t,i,(t=>{if(t)throw t}))}}},yt=vt,wt=(a("e6c1"),a("9f0a")),$t=Object(p["a"])(yt,pt,mt,!1,null,"002030ac",null),Ct=$t.exports;M()($t,"components",{QOptionGroup:wt["a"]});var kt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-btn",{attrs:{"no-caps":"","no-wrap":"",unelevated:"",color:"general","text-color":"red",label:t.$t("account_delete_account")},on:{click:t.deleteAccount}})},xt=[],St={name:"SecurityDeleteAccount",methods:{async deleteAccount(){const t=async t=>{const e={type:"password",model:"",icon:"lock",label:this.$t("account_password"),rules:[t=>!!t||this.$t("account_is_required")]},a=this.$alphabiz.dialog({title:this.$t("account_delete_account"),message:this.$t("account_tip_confirm_delete_account"),cancel:!0,prompts:{password:e},ok:{color:"negative",textColor:"negative",handler:()=>a.vm.dialog$useLoadingState("ok",(async()=>{const{prompts:e}=a.vm.dialog$arguments(),n=await t(e.password);n&&a.vm.hide()}))}});await a.promise()};await t((async t=>{try{return await this.$store.dispatch("ACCOUNT_DELETE_USER",t),r["a"].showPositive("deleted"),this.$router.push("/"),this.$amplify.showSignedOutDialog(),!0}catch(e){r["a"].showNegative(e.message)}}))}}},qt=St,Nt=Object(p["a"])(qt,kt,xt,!1,null,null,null),Dt=Nt.exports;M()(Nt,"components",{QBtn:R["a"]});var Ot={name:"Security",components:{SettingFragment:_,SecurityChangePassword:ht,SecurityMFA:Ct,SecurityDeleteAccount:Dt}},Lt=Ot,At=(a("5fad"),Object(p["a"])(Lt,ot,st,!1,null,"644c6322",null)),Et=At.exports,Tt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return this.$store.state.account.invitationCode&&this.$store.state.account.invitationCode.length>0?a("setting-fragment",{attrs:{label:t.$t("account_invitation")}},[a("div",{staticClass:"account-setting__invitation"},[a("q-list",{staticClass:"account-setting__invitation-code-container",attrs:{bordered:"",separator:""}},[t._l(t.code,(function(e,n){return[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple",value:!t.loading&&2!==e.state,expression:"!loading && item.state!==2"}],key:n,staticClass:"account-setting__invitation-code-item q-px-lg",attrs:{readonly:t.loading,clickable:!t.loading&&2!==e.state},on:{click:function(){return t.handleCodeClick(e)}}},[a("q-item-section",[a("q-item-label",{staticClass:"text-weight-bold",attrs:{overline:""}},[t._v(t._s(e.code))]),1===e.state?a("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.phone))]):t._e(),1===e.state?a("q-item-label",{attrs:{caption:""}},[t._v(t._s(e.email))]):t._e()],1),a("q-item-section",{attrs:{side:""}},[a("q-badge",{attrs:{color:["positive","blue","general"][e.state],"text-color":["positive","white","general"][e.state],label:t.$t(["account_available","account_invited","account_used"][e.state])}})],1)],1)]}))],2)],1),a("amplify-dialog",{attrs:{title:t.$t("account_invitation"),"on-submit":t.handleInvite,"on-clear":t.handleClear},scopedSlots:t._u([{key:"description",fn:function(){return[a("div",{staticClass:"q-pb-md",staticStyle:{"max-width":"284px"}},[t._v("\n        "+t._s(t.$t("account_invitation_code_dialog_tip"))),a("span",{staticClass:"text-weight-bold"},[a("div",{staticClass:"target-code-field inline-block q-py-xs rounded-borders"},[t._v("  "+t._s(t.targetCode)+"  ")])])])]},proxy:!0},{key:"default",fn:function(e){var n=e.disable;return t._l(t.form.items,(function(e,i){return a("amplify-input",t._b({key:i,staticStyle:{width:"309px"},attrs:{label:t.$t(e.bound.label),readonly:n},model:{value:e.model,callback:function(a){t.$set(e,"model",a)},expression:"item.model"}},"amplify-input",e.bound,!1))}))}}],null,!1,3947596930),model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}})],1):t._e()},Pt=[];class Mt{constructor(t){this.code=t.invitation_code,this.state=t.invitation_state,this.date=new Date(t.production_date).toISOString(),this.phone=t.contact_phone,this.email=t.contact_email}}class jt extends _t["a"]{constructor(t){super({contact_email:new _t["b"]("",{type:"email",icon:"email",label:"account_email"}),contact_phone:new _t["b"](["86","","CN"],{type:"tel",icon:"phone",label:"account_phone_number",rules:[Q["d"].bind(t)]})})}setDefault(t){var e;const a=null!==(e=Y["b"][t])&&void 0!==e?e:Y["b"]["en-us"],[n,i]=a.phones[0].split("-"),o=this.items.contact_phone;return o.updateModel([n,o.value[1],i]),this}}var It={name:"Invitation",components:{SettingFragment:_},props:{loading:Boolean},data(){return{showDialog:!1,targetCode:"",form:new jt(this).setDefault(this.$q.lang.getLocale().toLowerCase()),resolveCallback:null}},computed:{code(){const t=this.$store.state.account.invitationCode;return t?t.map((t=>new Mt(t))):[]}},methods:{invite(){return new Promise(((t,e)=>{const a=this.code.find((t=>0===t.state));a?(this.targetCode=a.code,this.showDialog=!0,this.resolveCallback=()=>{t()}):e("invitation_no_code")}))},handleCodeClick(t){this.loading||(1===t.state?navigator.clipboard.writeText(t.code).then((()=>r["a"].showPositive("clipboard_with_invitation_code"))):(this.targetCode=t.code,this.showDialog=!0))},async handleInvite(){const t=this.form.formData;t.code=this.targetCode;const e=t.contact_email,a=t.contact_phone[1]?`+${t.contact_phone[0]}${t.contact_phone[1]}`:null;if(console.log(a,e,!!a||!!e),a||e)try{return await this.dispatch("ACCOUNT_INVITE_CODE",{code:t.code,contactEmail:e||"",contactPhone:a||""}),r["a"].showPositive("invitation_code_sent"),!0}catch({message:n}){r["a"].showNegative(n)}else r["a"].showNegative("invitation_channel_required")},handleClear(){this.form.clearData().setDefault(this.$q.lang.getLocale().toLowerCase()),this.resolveCallback&&this.resolveCallback()}}},Qt=It,Ut=(a("2b95"),Object(p["a"])(Qt,Tt,Pt,!1,null,"cc3ccad6",null)),Ft=Ut.exports;M()(Ut,"components",{QList:Z["a"],QItem:L["a"],QItemSection:A["a"],QItemLabel:T["a"],QBadge:tt["a"]}),M()(Ut,"directives",{Ripple:at["a"]});var Bt=function(){var t=this,e=this,a=e.$createElement,n=e._self._c||a;return n("setting-fragment",{attrs:{label:"OAuth"}},[n("div",{staticClass:"account-setting__oauth-manager"},[n("q-list",{staticClass:"account-setting__oauth-manager-container",attrs:{bordered:"",separator:""}},e._l(e.oauthItems,(function(t){return n("q-item",{key:t.providerName},[n("q-item-section",{attrs:{top:"",avatar:""}},[n("q-item-label",{staticClass:"q-mt-sm"},[e._v(e._s(t.providerName))])],1),n("q-item-section",[n("q-item-label",{attrs:{caption:""}},[e._v(e._s(t.caption))])],1),n("q-item-section",{attrs:{top:"",side:""}},[t.linked?n("div",[n("q-btn",{attrs:{size:"12px",flat:"",round:"",icon:"delete"},on:{click:t.deleteFn}})],1):n("div",[n("q-btn",{attrs:{size:"12px",flat:"",round:"",icon:"add"},on:{click:t.addFn}})],1)])],1)})),1)],1),e.oauthDialogData?n("amplify-dialog",{attrs:{title:e.oauthDialogData.title,"on-submit":e.oauthDialogData.onSubmit,"on-clear":function(){return t.oauthDialogData=null}},model:{value:e.showOAuthDialog,callback:function(t){e.showOAuthDialog=t},expression:"showOAuthDialog"}},[n("div",[e._v(e._s(e.oauthDialogData.description))])]):e._e()],1)},zt=[],Kt=(a("e01a"),a("a79d"),a("bf82")),Rt={name:"OAuthManager",components:{SettingFragment:_},props:{loading:Boolean},data(){return{oauthProviders:["Facebook","Google","Github"],showOAuthDialog:!1,oauthDialogData:null}},computed:{oauthItems(){const t=this.oauthProviders.reduce(((t,e)=>{const a=()=>this.handleAddClick(e);return t[e]={linked:!1,providerName:e,caption:"none",addFn:a},t}),{});if(this.$store.state.account.identities){const e=this.$store.state.account.identities.reduce(((t,e)=>{const a=()=>this.handleDeleteClick(e.providerName);return t[e.providerName]={linked:!0,providerName:e.providerName,caption:e.userId,deleteFn:a},t}),{});return{...t,...e}}return t}},methods:{async handleDeleteClick(t){this.oauthDialogData={title:this.$t("account_unlink_your_social_account"),description:this.$t("account_tip_confirm_unlink",{provider:t}),onSubmit:()=>this.unlink(t)},this.showOAuthDialog=!0},async handleAddClick(t){this.$store.state.account.email&&this.$store.state.account.emailVerified?(this.oauthDialogData={title:this.$t("account_link_your_social_account"),description:this.$t("account_tip_confirm_link",{provider:t}),linkResult:null,onSubmit:()=>this.link(t)},this.showOAuthDialog=!0):r["a"].showNegative("error_can_not_link_before_email_verified")},async link(t){return this.oauthDialogData.description=this.$t("account_tip_linking"),await Kt["a"].launchOAuth("signedIn",{provider:t}),this.oauthDialogData.linkResult=null,await this.waitForLinkResult(),!0},async waitForLinkResult(){let t;await new Promise((e=>{t=setInterval((()=>{null===this.oauthDialogData.linkResult||e()}),1e3)})).finally((()=>{t&&clearInterval(t)}))},async handleLinkResult(t){t.verify&&t.verify(this.$store.state.account.email),t.error?r["a"].showNegative(t.error):(await this.$store.dispatch("ACCOUNT_REDIRECT_TO_INDEX").catch((()=>0)),r["a"].showPositive("linked")),this.oauthDialogData.linkResult=t},async unlink(t){try{this.oauthDialogData.description=this.$t("account_tip_unlinking"),await this.$store.dispatch("ACCOUNT_UNLINK_OAUTH",t),r["a"].showPositive("unlinked")}catch(e){r["a"].showNegative(e.message)}return!0}}},Vt=Rt,Wt=(a("2d0e"),Object(p["a"])(Vt,Bt,zt,!1,null,null,null)),Ht=Wt.exports;M()(Wt,"components",{QList:Z["a"],QItem:L["a"],QItemSection:A["a"],QItemLabel:T["a"],QBtn:R["a"]});var Gt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SettingFragment",{attrs:{label:t.$t("keychain_setting")},scopedSlots:t._u([{key:"label",fn:function(){return[a("q-icon",{staticClass:"q-ml-sm cursor-pointer",attrs:{name:"help_outline",color:"general",size:"1.25rem"},on:{click:t.showAbout}})]},proxy:!0}])},[a("div",{staticClass:"setting-library-key"},[a("StatusBanner",{attrs:{loading:t.currentLoading},on:{loading:function(e){return t.currentLoading=e}}},[t.$store.getters.keychainState.lib?a("div",{staticClass:"row full-width"},[a("ChangePassword",{attrs:{loading:t.currentLoading},on:{loading:function(e){return t.currentLoading=e}}})],1):t._e()]),a("q-list",{staticClass:"q-mt-sm rounded-borders overflow-hidden full-width",staticStyle:{"max-width":"calc(100vw - 16px)",border:"1px solid rgba(127,127,127,0.3)"}},[a("KeychainItem",{attrs:{loading:t.currentLoading},on:{loading:function(e){return t.currentLoading=e}}})],1)],1)])},Yt=[],Jt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-banner",{staticClass:"bg-general text-general rounded-borders full-width",staticStyle:{"max-width":"calc(100vw - 16px)"},scopedSlots:t._u([{key:"avatar",fn:function(){return[a("q-icon",{attrs:{size:"1.75rem",color:"cloud"===t.libKeyStatus.type?"green":void 0,name:{pending:"pending",cloud:"cloud_done",local:"cloud_off"}[t.libKeyStatus.type]}})]},proxy:!0},{key:"default",fn:function(){return[a("div",{staticClass:"relative-position q-mb-sm"},[a("div",{staticClass:"text-weight-bold"},[t._v(t._s(t.$t("keychain_sync_status")))]),a("div",[t._v(t._s(t.libKeyStatusSummary))]),t.libKeyStatus.useCognito?a("div",[t._v("\n        "+t._s(t.$t("independent_password_not_enabled"))+"\n      ")]):t._e(),a("div",{staticClass:"absolute-top-right",staticStyle:{margin:"-8px -8px 0 0"}},[a("q-btn",{attrs:{flat:"",round:"",icon:"refresh",disable:!!t.currentLoading,loading:"sync_keychain_state"===t.currentLoading},on:{click:function(e){return t.useCurrentLoading("sync_keychain_state",t.syncKeychainState)}}})],1)])]},proxy:!0},{key:"action",fn:function(){return[a("div",["local"===t.libKeyStatus.type?a("q-btn",{attrs:{flat:"","no-wrap":"","no-caps":"",icon:"cloud",color:"green","text-color":"green",label:t.$t("enable_cloud_storage"),disable:!!t.currentLoading||"local"!==t.libKeyStatus.type,loading:"enable_cloud_storage"===t.currentLoading},on:{click:function(e){return t.useCurrentLoading("enable_cloud_storage",t.keychain$enableCloudStorage)}}}):"cloud"===t.libKeyStatus.type?a("q-btn",{attrs:{flat:"","no-wrap":"","no-caps":"",icon:"cloud_off",color:"red","text-color":"red",label:t.$t("disable_cloud_storage"),disable:!!t.currentLoading||"cloud"!==t.libKeyStatus.type,loading:"disable_cloud_storage"===t.currentLoading},on:{click:function(e){return t.useCurrentLoading("disable_cloud_storage",t.keychain$disableCloudStorage)}}}):t._e()],1),t.$slots.default?a("div",{staticClass:"full-width"},[a("div",{staticClass:"column",staticStyle:{margin:"0 -16px"}},[[a("q-separator",{staticClass:"q-mt-sm q-mb-xs"})],a("div",{staticClass:"q-px-xs"},[t._t("default")],2)],2)]):t._e()]},proxy:!0}],null,!0)})},Xt=[],Zt=a("0613"),te={props:{loading:[Object,String]},computed:{currentLoading:{get(){return this.loading},set(t){this.$emit("loading",t)}}},methods:{async useCurrentLoading(t,e){try{this.currentLoading=t,await e()}finally{this.currentLoading=null}}}},ee=a("a4d4"),ae=a("c894"),ne={name:"StatusBanner",i18n:ae["a"],mixins:[te,ee["b"]],computed:{libKeyStatus(){const t={};if("sync_keychain_state"===this.currentLoading)return t.type="pending",t;const e=Zt["a"].getters.keychainState.lib;return t.type=e?"cloud":"local",e&&(t.useCognito=Zt["a"].getters.keychainState.unset),t},libKeyStatusSummary(){return"pending"===this.libKeyStatus.type?this.$t("loading"):"local"===this.libKeyStatus.type?this.$t("cloud_storage_disabled"):this.$t("cloud_storage_enabled",{storage:"Amazon Web Services"})}},methods:{async syncKeychainState(){await Zt["a"].dispatch("syncKeychainState")}},mounted(){this.syncKeychainState()}},ie=ne,oe=a("54e1"),se=a("eb85"),re=Object(p["a"])(ie,Jt,Xt,!1,null,null,null),le=re.exports;M()(re,"components",{QBanner:oe["a"],QIcon:E["a"],QBtn:R["a"],QSeparator:se["a"]});var ce=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-item",{staticClass:"q-pa-md"},[a("q-item-section",{staticStyle:{"min-width":"unset"},attrs:{avatar:""}},[a("q-icon",{staticStyle:{opacity:"0.7"},attrs:{size:"1.75rem",name:"video_library"}})],1),a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("keychain_"+t.key)))]),a("q-item-label",{attrs:{caption:""}},[t.syncEnabled?[t._v("\n        "+t._s(t.$t("sync_at",{time:t.$d(t.timestamp,"YMDHms")}))+"\n      ")]:[t._v("\n        "+t._s(t.$t("saved_locally"))+"\n      ")]],2)],1),a("q-item-section",{attrs:{side:""}},[a("q-btn",{staticStyle:{margin:"-8px -8px -8px 0"},attrs:{icon:"more_vert",flat:"",round:""}},[a("q-menu",{attrs:{"touch-position":"","auto-close":"","transition-show":"jump-down","transition-hide":"jump-up"}},[a("q-list",{staticStyle:{"min-width":"180px"}},[a("q-item",{attrs:{clickable:""},on:{click:function(){return t.useCurrentLoading("import_local_key",t.lib$importLocalKey)}}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("import_local_key")))])],1)],1),a("q-item",{attrs:{clickable:""},on:{click:function(){return t.useCurrentLoading("export_current_key",t.lib$exportCurrentKey)}}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("export_current_key")))])],1)],1),t.syncEnabled?[a("q-separator"),a("q-item",{attrs:{clickable:""},on:{click:function(){return t.useCurrentLoading("export_cloud_key",t.lib$exportCloudKey)}}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("export_cloud_key")))])],1)],1),a("q-item",{attrs:{clickable:""},on:{click:function(){return t.useCurrentLoading("backup_current_key",t.lib$backupCurrentKey)}}},[a("q-item-section",[a("q-item-label",[t._v(t._s(t.$t("backup_current_key")))])],1)],1)]:t._e()],2)],1)],1)],1)],1)},ue=[],de=a("e65a"),he={name:"KeychainItem",i18n:ae["a"],mixins:[te,de["b"]],data(){return{key:"lib"}},computed:{syncEnabled(){return!!this.$store.getters.keychainState.lib},timestamp(){return this.$store.getters.keychainState.timestamps[this.key]||0}}},pe=he,me=a("4e73"),_e=Object(p["a"])(pe,ce,ue,!1,null,null,null),be=_e.exports;M()(_e,"components",{QItem:L["a"],QItemSection:A["a"],QIcon:E["a"],QItemLabel:T["a"],QBtn:R["a"],QMenu:me["a"],QList:Z["a"],QSeparator:se["a"]});var ge=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-btn",{attrs:{unelevated:"","no-caps":"","no-wrap":"",color:"general","text-color":"general",label:t.$t("change_password"),disable:!!t.currentLoading,loading:"change_password"===t.currentLoading},on:{click:function(e){return t.useCurrentLoading("change_password",t.keychain$changePassword)}}})},fe=[],ve={name:"ChangePassword",i18n:ae["a"],mixins:[te,ee["b"]]},ye=ve,we=Object(p["a"])(ye,ge,fe,!1,null,"72f877a7",null),$e=we.exports;M()(we,"components",{QBtn:R["a"]});var Ce={name:"SettingKeychain",components:{SettingFragment:_,StatusBanner:le,KeychainItem:be,ChangePassword:$e},i18n:ae["a"],data(){return{currentLoading:null,showSetting:!1,showChangePassword:!1,input:{oldPassword:"",password:""},libraryPassword:""}},methods:{showAbout(){this.$alphabiz.dialog({title:this.$t("keychain_setting"),message:this.$t("setting_description")})}}},ke=Ce,xe=(a("b798"),Object(p["a"])(ke,Gt,Yt,!1,null,"4f6ddcb6",null)),Se=xe.exports;M()(xe,"components",{QIcon:E["a"],QList:Z["a"]});var qe=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SettingFragment",{attrs:{label:t.$t("library_setting")}},[a("div",{staticClass:"setting-library-key"},[a("BlockList",{attrs:{loading:t.currentLoading},on:{loading:function(e){return t.currentLoading=e}}}),a("EditProfile",{attrs:{loading:t.currentLoading},on:{loading:function(e){return t.currentLoading=e}}})],1)])},Ne=[];const De={library_setting:["Library setting","媒体库设置","媒體庫設置"],block_list_manage:["Block list manage","屏蔽列表管理","屏蔽列表管理"],blocked_users:["Blocked users","已屏蔽的用户","已屏蔽的用戶"],blocked_channels:["Blocked channels","已屏蔽的频道","已屏蔽的頻道"],unblock_user:["Unblock user","解除用户屏蔽","解除用戶屏蔽"],unblock_channel:["Unblock channel","解除频道屏蔽","解除頻道屏蔽"],no_blocked_user:["No blocked user","没有已屏蔽的用户","沒有已屏蔽的用戶"],no_blocked_channel:["No blocked channel","没有已屏蔽的频道","沒有已屏蔽的頻道"],field_required:["{0} is required","{0}不能为空","{0}不能為空"]},Oe={"en-US":{},"zh-CN":{},"zh-TW":{}},Le=Object.keys(Oe);Object.keys(De).forEach((t=>{De[t].forEach(((e,a)=>{Oe[Le[a]][t]=e}))}));var Ae={messages:Oe},Ee=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"block-list-manage"},[a("q-btn",{staticClass:"full-width",attrs:{unelevated:"","no-wrap":"","no-caps":"",color:"general","text-color":"general",label:t.$t("block_list_manage"),disable:!!t.currentLoading},on:{click:function(e){t.show=!0}}}),a("q-dialog",{model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("q-card",[a("q-card-section",{staticClass:"q-px-md q-pt-lg q-pb-none"},[a("div",{staticClass:"q-mt-xs text-h6 text-weight-bold non-selectable"},[t._v(t._s(t.$t("block_list_manage")))])]),a("q-card-section",{staticClass:"q-pb-none q-px-none row items-center"},[a("q-markup-table",{staticClass:"col-12 q-mb-md",attrs:{flat:""}},[a("thead",[a("tr",[a("th",{staticClass:"table-header text-left",attrs:{colspan:"3"}},[t._v(t._s(t.$t("blocked_users")))])]),a("tr",[a("th",{staticClass:"text-left table-id"},[t._v("ID")]),a("th",{staticClass:"text-left"},[t._v(t._s(t.$t("account_username")))]),a("th",{staticClass:"text-center table-operations"},[t._v(t._s(t.$t("operations")))])])]),a("tbody",[t._l(t.blockUsers,(function(e){return a("tr",{key:e.id},[a("td",{staticClass:"text-left table-id"},[t._v(t._s(e.id))]),a("td",{staticClass:"text-left table-name"},[t._v(t._s(e.name))]),a("td",{staticClass:"text-center table-operations"},[a("q-btn",{attrs:{"fab-mini":"",unelevated:"","text-color":"general",icon:"remove_circle_outline"},on:{click:function(a){return t.unblockUser(e.uid)}}},[a("q-tooltip",[t._v(t._s(t.$t("unblock_user")))])],1)],1)])})),t.blockUsers.length?t._e():a("tr",[a("td",{attrs:{colspan:"3"}},[a("div",{staticClass:"empty-placeholder"},[a("q-icon",{staticClass:"empty-icon",attrs:{name:"help_outline",size:"16px"}}),a("span",{staticClass:"empty-hint q-ml-sm"},[t._v(t._s(t.$t("no_blocked_user")))])],1)])])],2)]),a("q-markup-table",{staticClass:"col-12",attrs:{flat:""}},[a("thead",[a("tr",[a("th",{staticClass:"table-header text-left",attrs:{colspan:"3"}},[t._v(t._s(t.$t("blocked_channels")))])]),a("tr",[a("th",{staticClass:"text-left table-id"},[t._v(t._s(t.$t("channel_id")))]),a("th",{staticClass:"text-left"},[t._v(t._s(t.$t("channel_title")))]),a("th",{staticClass:"text-center table-operations"},[t._v(t._s(t.$t("operations")))])])]),a("tbody",[t._l(t.blockChannels,(function(e){return a("tr",{key:e.id},[a("td",{staticClass:"text-left table-id"},[t._v(t._s(e.id))]),a("td",{staticClass:"text-left table-name",attrs:{title:e.title}},[t._v(t._s(e.title))]),a("td",{staticClass:"text-center table-operations"},[a("q-btn",{attrs:{"fab-mini":"",unelevated:"","text-color":"general",icon:"remove_circle_outline"},on:{click:function(a){return t.unblockChannel(e.id)}}},[a("q-tooltip",[t._v(t._s(t.$t("unblock_channel")))])],1)],1)])})),t.blockChannels.length?t._e():a("tr",[a("td",{attrs:{colspan:"3"}},[a("div",{staticClass:"empty-placeholder"},[a("q-icon",{staticClass:"empty-icon",attrs:{name:"help_outline",size:"16px"}}),a("span",{staticClass:"empty-hint q-ml-sm"},[t._v(t._s(t.$t("no_blocked_channel")))])],1)])])],2)])],1),a("q-card-actions",{staticClass:"q-px-md q-py-md",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-md",attrs:{unelevated:"",color:"general","text-color":"general",icon:"close",label:t.$t("cancel")}})],1)],1)],1)],1)},Te=[],Pe=a("4aad"),Me={props:{loading:[Object,String]},computed:{currentLoading:{get(){return this.loading},set(t){this.$emit("loading",t)}}},methods:{async useCurrentLoading(t,e){try{this.currentLoading=t,await e()}finally{this.currentLoading=null}}}},je={name:"BlockList",i18n:Ae,mixins:[Me],data(){return{show:!1,blockUsers:[],lib:Pe["a"]}},computed:{blockChannels(){return Pe["a"].userData&&Pe["a"].userData.blockChannels?Pe["a"].userData.blockChannels.map((t=>{const e=this.getChannelData(t);if(!e||!e.title)return null;const a=e.title;return{title:a,id:t}})):[]}},methods:{getUserData(t){return console.log("get user",t),Pe["a"].getUserProfile(t).then((e=>{const a=e&&e.name?e.name:"(Unknown)";return Object.assign(e,{name:a,uid:t})}))},getChannelData(t){const e=Pe["a"].allChannelList.find((e=>e.id===t));return{id:t,title:e&&e.title?e.title:"(Unknown)"}},unblockUser(t){Pe["a"].unblockUser(t).then((e=>{console.log("unblock user result",e,t)})).catch((t=>{console.log(t)}))},unblockChannel(t){Pe["a"].unblockChannel(t).then((t=>{console.log("unblock channel result",t)}))}},mounted(){this.$watch("lib.userData.blockUsers",(t=>{t&&t.length||this.blockUsers.splice(0);for(let e=0;e<this.blockUsers.length;e++)t.includes(this.blockUsers[e].id)||this.blockUsers.splice(e--,1);for(const e of t)this.blockUsers.find((t=>t.id===e))||this.getUserData(e).then((t=>{this.blockUsers.find((t=>t.id===e))||this.blockUsers.push(t)}))}),{immediate:!0})}},Ie=je,Qe=(a("9f4c"),a("24e8")),Ue=a("f09f"),Fe=a("a370"),Be=a("2bb1"),ze=a("4b7e"),Ke=a("7f67"),Re=Object(p["a"])(Ie,Ee,Te,!1,null,"f3d49986",null),Ve=Re.exports;M()(Re,"components",{QBtn:R["a"],QDialog:Qe["a"],QCard:Ue["a"],QCardSection:Fe["a"],QMarkupTable:Be["a"],QTooltip:et["a"],QIcon:E["a"],QCardActions:ze["a"]}),M()(Re,"directives",{ClosePopup:Ke["a"]});var We=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"edit-profile"},[a("q-btn",{staticClass:"full-width",attrs:{unelevated:"","no-wrap":"","no-caps":"",color:"general","text-color":"general",label:t.$t("edit_user_profile"),disable:!!t.currentLoading},on:{click:t.showEdit}}),a("q-dialog",{attrs:{persistent:""},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("q-card",{staticClass:"profile-editor"},[a("q-card-section",{staticClass:"q-px-md q-pt-lg q-pb-none"},[a("div",{staticClass:"q-mt-xs text-h6 text-weight-bold non-selectable"},[t._v(t._s(t.$t("edit_user_profile")))])]),a("q-card-section",{staticClass:"q-pb-none column items-stretch"},[a("q-input",{staticClass:"q-mb-xs",attrs:{type:"text",outlined:"",dense:"",label:t.$t("account_nickname"),rules:[t.validateUserName]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.profile.name,callback:function(e){t.$set(t.profile,"name",e)},expression:"profile.name"}}),a("q-input",{staticClass:"q-mb-xs",attrs:{type:"text",outlined:"",dense:"",label:t.$t("description"),rules:[t.validateUserDesc]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.profile.description,callback:function(e){t.$set(t.profile,"description",e)},expression:"profile.description"}}),a("ImageWithPreview",{staticStyle:{"margin-bottom":"-8px"},attrs:{label:t.$t("avatar")+"(url)",rules:[t.validateUserAvatar]},on:{state:t.updateAvatarState},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.profile.avatar,callback:function(e){t.$set(t.profile,"avatar",e)},expression:"profile.avatar"}})],1),a("q-card-actions",{staticClass:"q-px-md q-pb-md",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-md",attrs:{unelevated:"",color:"general","text-color":"general",icon:"close",label:t.$t("cancel")}}),a("q-btn",{staticClass:"q-px-md",attrs:{unelevated:"",color:"primary","text-color":"primary",icon:"done",label:t.$t("lib_submit")},on:{click:t.submit}})],1)],1)],1)],1)},He=[],Ge=a("c65d"),Ye={name:"EditProfile",i18n:Ae,mixins:[Me],components:{ImageWithPreview:Ge["a"]},data(){return{show:!1,avatarState:0,profile:{name:"",description:"",avatar:""}}},computed:{userProfile(){return Pe["a"].userData}},methods:{validateUserName(t){return t?t.match(/\s/)?this.$t("validate_user_name_no_space"):!(t.length<4||t.length>12)||this.$t("validate_user_name_length",[4,12]):this.$t("field_required",[this.$t("account_nickname")])},validateUserDesc(t){return t?!(t.length>120)||this.$t("validate_user_desc_length",[120]):this.$t("field_required",[this.$t("description")])},validateUserAvatar(t){return!t||(t.match(/\s/)?this.$t("validate_url_no_space"):!!((t.startsWith("http://")||t.startsWith("https://"))&&t.length<2048)||this.$t("validate_user_avatar_url"))},validateUser(){return[this.validateUserName(this.profile.name),this.validateUserDesc(this.profile.description),this.validateUserAvatar(this.profile.avatar)]},updateAvatarState(t){this.avatarState=t},showEdit(){this.profile={name:this.userProfile.name,description:this.userProfile.description,avatar:this.userProfile.avatar},this.show=!0},submit(){if(1!==this.avatarState&&this.profile.avatar)return this.$alphabiz.dialog({title:this.$t("validate_error"),message:"Url "+this.$t("error"),ok:this.$t("ok")});const t=this.validateUser().filter((t=>!0!==t));if(t.length)return this.$alphabiz.dialog({title:this.$t("validate_error"),message:t.join("; "),ok:this.$t("ok")});Pe["a"].changeProfile(this.profile).then((t=>{console.log("change profile result:",t),this.show=!1,this.$alphabiz.dialog({title:this.$t("edit_user_profile"),message:this.$t("success"),ok:this.$t("ok")})}))}}},Je=Ye,Xe=(a("ffd4"),Object(p["a"])(Je,We,He,!1,null,"5a679c18",null)),Ze=Xe.exports;M()(Xe,"components",{QBtn:R["a"],QDialog:Qe["a"],QCard:Ue["a"],QCardSection:Fe["a"],QInput:K["a"],QCardActions:ze["a"]}),M()(Xe,"directives",{ClosePopup:Ke["a"]});var ta={name:"SettingLibraryKey",components:{SettingFragment:_,BlockList:Ve,EditProfile:Ze},i18n:Ae,data(){return{currentLoading:null}}},ea=ta,aa=(a("37d7"),Object(p["a"])(ea,qe,Ne,!1,null,"b7e4ad50",null)),na=aa.exports,ia={name:"AccountSettings.vue",components:{OptionalInformation:W,VerificationFields:it,OAuthManager:Ht,Security:Et,Invitation:Ft,Keychain:Se,LibraryKey:na},data(){return{showUserEdit:!1,loading:!1}},mounted(){this.$route.query.call&&this.invite()},watch:{"$route.query.call"(t){t&&this.invite()}},methods:{setLoading(t){this.loading=t},invite(){if(this.loading)return;const t=this.$refs.invitation;t.invite().then((()=>{this.$router.push({path:this.$route.path,query:{}})}))}}},oa=ia,sa=(a("a404"),a("9989")),ra=a("4983"),la=Object(p["a"])(oa,n,i,!1,null,null,null);e["default"]=la.exports;M()(la,"components",{QPage:sa["a"],QScrollArea:ra["a"],QBtn:R["a"],QDialog:Qe["a"]})},"2b95":function(t,e,a){"use strict";a("3b41")},"2d0e":function(t,e,a){"use strict";a("ec18")},"37d7":function(t,e,a){"use strict";a("e3c8")},"3b41":function(t,e,a){},"464b":function(t,e,a){},"4f7a":function(t,e,a){"use strict";a("9312")},"5fad":function(t,e,a){"use strict";a("e6ed")},"65fb":function(t,e,a){"use strict";a("bd080")},"7d41":function(t,e,a){},"80a5":function(t,e,a){},8771:function(t,e,a){},9312:function(t,e,a){},"9f4c":function(t,e,a){"use strict";a("1272")},a2be:function(t,e,a){"use strict";a("8771")},a404:function(t,e,a){"use strict";a("464b")},b798:function(t,e,a){"use strict";a("7d41")},bd080:function(t,e,a){},d226:function(t,e,a){},e3c8:function(t,e,a){},e6c1:function(t,e,a){"use strict";a("80a5")},e6ed:function(t,e,a){},ec18:function(t,e,a){},ffd4:function(t,e,a){"use strict";a("130b")}}]);