(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"0c77":function(t,e,s){"use strict";s("d360")},"0ebe":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page-sticky",{staticClass:"back-top-top",attrs:{position:"bottom-right",offset:[16,16]}},[s("transition",{attrs:{name:"animate"}},[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"back-btn q-ma-xs",class:{hide:t.hide},attrs:{fab:"","no-wrap":"",size:"18px",color:"primary",icon:"publish"},on:{click:t.onClick}},[s("div",{staticClass:"fab-inner-text"},[t._v("\n        "+t._s(t.$t("back_to_top"))+"\n      ")])])],1)],1)},i=[],n={name:"BackToTop",props:{show:Boolean},data(){return{hide:!1,hovered:!1}},methods:{onClick(){this.$emit("click")}},activated(){this.hide=!0,setTimeout((()=>{this.hide=!1}),300)},deactivated(){this.hide=!0}},o=n,r=(s("ea83"),s("2877")),l=s("de5e"),c=s("9c40"),d=s("eebe"),h=s.n(d),u=Object(r["a"])(o,a,i,!1,null,"ca07e9c6",null);e["a"]=u.exports;h()(u,"components",{QPageSticky:l["a"],QBtn:c["a"]})},"1ec7":function(t,e,s){"use strict";s("665a")},"1ffc":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{width:"100%"}},[s("q-card",{staticClass:"torrent-item",attrs:{flat:"",bordered:""}},[s("q-card-section",{class:{highlight:t.highlight}},[s("div",{staticClass:"row justify-between items-center"},[s("div",{staticClass:"torrent-info title q-mb-xs"},[s("p",{staticClass:"torrent-name"},[t.isReady?t._e():s("q-circular-progress",{directives:[{name:"show",rawName:"v-show",value:!t.torrent.paused&&!t.torrent.pending,expression:"!torrent.paused && !torrent.pending"}],staticClass:"torrent-loading",attrs:{indeterminate:"",size:"24px",color:"primary"}}),s("span",[t._v(t._s(t.displayName))]),t.torrent.isAutoUpload?s("q-icon",{staticClass:"q-ml-md",attrs:{name:"drive_folder_upload"}},[s("q-tooltip",[t._v(t._s(t.$t("auto_uploading")))])],1):t._e()],1)]),s("alphabiz-button",{staticClass:"absolute-top-right q-mt-sm q-mr-md",attrs:{size:"md","button-type":"icon",icon:"more_horiz"},on:{click:t.showDetail}},[s("q-tooltip",[t._v(t._s(t.$t("more")))])],1)],1),s("div",{staticClass:"torrent-info"},[s("div",{staticClass:"operations"},[s("alphabiz-button",{directives:[{name:"show",rawName:"v-show",value:!t.torrent.isAutoUpload&&!(t.torrent.paused&&t.torrent.missFile),expression:"!torrent.isAutoUpload && !(torrent.paused && torrent.missFile)"}],attrs:{color:"general",value:t.locked,icon:t.actionIcon,label:t.torrentAction},on:{click:t.switchStateTorrent}}),t.isReady&&t.playable?s("alphabiz-button",{attrs:{color:"general",icon:"smart_display",label:t.torrent.done||t.torrent.isSeeding?t.$t("play"):t.$t("play_while_downloading")}},[s("q-menu",{attrs:{"max-height":"200px"}},[s("q-list",{staticStyle:{"min-width":"100px"}},t._l(t.playableFiles,(function(e,a){return s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:a,staticClass:"playable-items",attrs:{clickable:!e.missing,disable:e.missing},on:{click:function(s){return t.play(e.path,t.torrent.infoHash)}}},[s("q-linear-progress",{directives:[{name:"show",rawName:"v-show",value:1!==e.progress||e.isSeeding,expression:"item.progress !== 1 || item.isSeeding"}],staticClass:"progress-background",attrs:{stripe:"",value:e.progress,color:"primary"}}),s("q-item-section",[s("p",{staticClass:"q-ma-none"},[s("q-icon",{staticClass:"q-mr-xs",attrs:{name:"play_arrow"}}),t._v("\n                      "+t._s(e.name)+"\n                      "),e.missing?s("q-icon",{attrs:{name:"error",color:"primary"}}):1===e.progress?s("q-icon",{attrs:{name:"done",color:"primary"}}):t._e(),e.missing?s("q-tooltip",[t._v(t._s(t.$t("file_not_found")))]):t._e(),1!==e.progress||t.isElectron?t._e():s("q-btn",{staticClass:"save-to-local-btn",attrs:{flat:"",dense:"",color:"primary",icon:"save"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.saveFile(e)}}},[s("q-tooltip",[t._v(t._s(t.$t("save_to_local")))])],1)],1)])],1)})),1)],1)],1):s("alphabiz-button",{attrs:{color:"general",icon:"file_open",label:t.$t("open_file")},on:{click:t.openFile}}),t.isElectron?s("alphabiz-button",{attrs:{color:"general",icon:"folder",label:t.$t("open_directory")},on:{click:t.showDirectory}}):t._e(),t.torrent.fromPost?s("alphabiz-button",{attrs:{icon:"video_library",label:t.$t("library")},on:{click:t.showPostInfo}}):t._e(),1!==t.torrent.progress||t.torrent.paused?t._e():s("alphabiz-button",{attrs:{icon:"present_to_all",label:t.$t("share_to_library")},on:{click:t.showQuickStart}}),!t.isElectron&&t.torrent.done?s("alphabiz-button",{attrs:{label:t.$t("save_as_zip"),icon:"folder_zip"},on:{click:t.saveZip}}):t._e(),s("alphabiz-button",{attrs:{color:"negative",icon:"close",label:t.$t("delete")},on:{click:t.deleteTorrent}}),s("q-space"),t.showAbButton?s("alphabiz-button",{attrs:{color:"accent",icon:t.isPayed?"flash_auto":"flash_on"},on:{click:t.openAbPanel}},[s("q-tooltip",[t._v(t._s(t.isPayed?t.$t("alphabiz_accelerating"):t.$t("ab_peer_available")))])],1):t._e()],1),t.torrent.upload||t.torrent.isSeeding?t._e():s("q-linear-progress",{staticClass:"q-mt-md",attrs:{value:t.torrent.done?1:t.torrent.progress,size:"18px",color:"primary",rounded:""}},[s("div",{staticClass:"progress-text flex flex-center absolute-full"},[t._v(t._s(t.progress||"0%"))])]),s("p",{staticClass:"text q-mb-xs bottom-status"},[t.statusText?s("span",{staticClass:"hint status-text"},[s("small",[t._v(t._s(t.statusText))]),s("br")]):t._e(),s("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(this.$t("status"))+": "+t._s(t.torrentStatus))]),s("span",[t.torrent.paused||t.torrent.done||t.torrent.pending||t.torrent.isSeeding?t._e():s("span",{staticClass:"q-mr-sm"},[t._v("\n              "+t._s(t.downloadSpeed)+"\n            ")]),t.torrent.upload?t._e():s("span",{staticStyle:{"margin-right":"10px"}},[t._v("↓ "+t._s(t.downloaded)+" / "+t._s(t.total))])]),s("span",[t.torrent.paused||t.torrent.done||t.torrent.pending?t._e():s("span",{staticClass:"q-mr-sm"},[t._v("\n              "+t._s(t.uploadSpeed)+"\n            ")]),s("span",{staticStyle:{"margin-right":"10px"}},[t._v("↑ "+t._s(t.uploaded))])])]),s("p",{staticClass:"text timers q-mt-xs bottom-status"},[t.torrent.timeRemaining&&t.torrent.download?s("span",{staticClass:"remaining q-mr-md"},[t._v(t._s(t.$t("remaining"))+": "+t._s(t.remaining))]):t._e(),t.createdTime?s("span",[t._v(t._s(t.$t("created_time")+": "+t.createdTime))]):t._e(),t.completedTime?s("span",[t._v(t._s(t.$t("completed_time")+": "+t.completedTime))]):t._e(),t.usedTime?s("span",[t._v(t._s(t.$t("used_time")+": "+t.usedTime))]):t._e()])],1)])],1)],1)},i=[],n=(s("5319"),s("ddb0"),s("307e")),o=s("f880"),r=s("0613"),l=s("ed08");let c;try{c=s("bdb9").clipboard}catch(O){c=navigator.clipboard}var d={name:"CardItem",inject:["io"],props:{torrent:{type:Object,required:!0},statusText:String,highlight:Boolean},data(){return{levelOptions:[{label:" Low ",value:"low"},{label:" Middle ",value:"mid"},{label:" High ",value:"high"}],locked:!1,loading:!1,isElectron:Object(l["isElectron"])()}},computed:{isDevMode(){return r["a"].getters.isDevMode},torrentAction(){return this.torrent.paused?this.torrent.done||1===this.torrent.progress||this.torrent.isSeeding?this.$t("seed"):this.$t("resume"):this.torrent.isSeeding?this.$t("stop_torrent"):this.$t("pause")},actionIcon(){return this.torrent.paused?this.torrent.done||this.torrent.isSeeding?"cloud_upload":"play_arrow":this.torrent.isSeeding?"stop":"pause"},isReady(){return this.torrent&&this.torrent.name&&this.torrent.length},downloadSpeed(){return this.byteToLargerSize(this.torrent.downloadSpeed)+"/s"},downloaded(){return this.byteToLargerSize(this.torrent.downloaded)},uploadSpeed(){return this.byteToLargerSize(this.torrent.uploadSpeed)+"/s"},uploaded(){return this.byteToLargerSize(this.torrent.uploaded)},total(){return this.byteToLargerSize(this.torrent.length)},remaining(){return!this.torrent.timeRemaining||this.torrent.paused?"-":this.msToTime(this.torrent.timeRemaining)},createdTime(){return this.torrent.createdTime?new Date(this.torrent.createdTime).toLocaleString(this.$i18n.locale,{hour12:!1}):""},completedTime(){return this.torrent.completedTime&&this.torrent.done?new Date(this.torrent.completedTime).toLocaleString(this.$i18n.locale,{hour12:!1}):""},usedTime(){return this.torrent.usedTime?this.msToTime(this.torrent.usedTime):""},torrentStatus(){if(this.torrent.isSeeding||this.torrent.done){if(this.torrent.missFile)return this.$t("miss_file");if(!this.torrent.length){if(this.torrent.verifyStatus){const{current:t,total:e}=this.torrent.verifyStatus,s=t/e,a=Object(o["f"])(s);return this.$t("loading")+` (${a})`}return this.$t("loading")}return this.torrent.paused?this.$t("downloaded"):this.$t("uploading")}if(this.paused)return this.$t("paused");if(this.torrent.paused)return this.torrent.done||this.torrent.isSeeding?this.$t("completed"):this.$t("paused");if(this.torrent.isSeeding)return this.$t("seeding");if(this.torrent.upload)return this.$t("uploading");if(this.torrent.pending)return this.$t("pending");if(this.torrent.waiting)return this.$t("waiting_for_verify");if(!this.torrent.ready){if(this.torrent.verifyStatus){const{current:t,total:e}=this.torrent.verifyStatus,s=t/e,a=Object(o["f"])(s);if(!isNaN(s))return this.$t("loading")+` (${a})`}return this.$t("loading")}return this.torrent.download?this.torrent.done?this.$t("downloaded"):this.$t("downloading"):this.$t("unknown_status")},displayName(){let t=this.torrent.postTitle||this.torrent.name||this.torrent.origin||this.torrent.token;if(!t||"string"!==typeof t){if(!(t&&t instanceof File))return this.$t("loading");t=t.name}if(t.includes("&dn")){const e=(t+"&").match(/&dn=(.*?)&/);if(e&&e[1])return e[1]}const e=t.match(/btih:([^&]*)/);if(e&&e[1])return e[1];if(t.includes("/")||t.includes("\\")){const e=t.replace(/(\\|\/)$/,"").match(/([^\\/]*$)/);if(e&&e[1])return e[1]}return t},progress(){return Object(o["f"])(this.torrent.progress)},abPeers(){return this.torrent.connections?this.torrent.connections.filter((t=>!(!this.torrent.hasMetadata&&!t.hasMeta)&&(!!t.hasResource&&(t.isAbPeer&&t.subId&&t.subId!==r["a"].getters.accountUserInfo.sub)))):[]},showAbButton(){return!this.torrent.done&&!this.torrent.isSeeding&&(this.isDevMode&&this.abPeers.length)},payedConnections(){return this.abPeers.filter((t=>"high"===t.remoteGroup))},isPayed(){return this.payedConnections.length},showAbPeerHint(){return this.abPeers.length},connectedPeers(){const t={};for(const e of this.abPeers){const s=e.subId||e.id;t[s]?t[s].isAbPeer|=e.isAbPeer:(t[s]=e,t[s].addresses=[]),t[s].addresses.includes(e.address)||t[s].addresses.push(e.address)}return Object.values(t).sort(((t,e)=>t.id.localeCompare?t.id.localeCompare(e.id):0))},playableFiles(){return this.torrent.files.filter((t=>Object(n["a"])(t.name)))},playable(){return this.playableFiles.length}},methods:{byteToLargerSize(t){return Object(o["a"])(t,{byte:!0,gb:!0})},msToTime(t){const e=Math.floor(t/1e3),s=e%60,a=(e-s)/60;if(isNaN(s))return"-";if(a>60){const t=a%60,e=(a-t)/60;return e>24?"> 24h":`${e}:${("0"+t).slice(-2)}:${("0"+s).slice(-2)}`}return`${("0"+a).slice(-2)}:${("0"+s).slice(-2)}`},deleteTorrent(){this.$emit("deleteTorrent",this.torrent)},switchStateTorrent(){if(!this.locked)if(this.locked=!0,this.torrent.isSeeding?setTimeout((()=>{this.locked=!1}),2e3):setTimeout((()=>{this.locked=!1}),1e3),this.torrent.paused)this.$emit("resumeTorrent",this.torrent);else{if(!this.torrent.infoHash)return this.$q.dialog({message:this.$t("this_task_not_ready"),ok:this.$t("remove"),cancel:this.$t("cancel")}).onOk((()=>{this.io.emit("delete_torrent",this.torrent.token,!1)}));this.$emit("pauseTorrent",this.torrent.infoHash)}},openAbPanel(){console.log("open"),this.$emit("showAbPanel",this.torrent)},showDetail(){this.$emit("showDetail",this.torrent)},setThrottleGroup(t,e,s){this.$emit("setThrottleGroup",{infoHash:this.torrent.infoHash,id:t,subId:e,level:s})},saveTorrentFile(){this.$emit("saveTorrentFile",this.torrent.infoHash)},play(t,e){this.$emit("play",t,e)},copyMagnetURI(){let t=this.torrent.alphabizURI||this.torrent.magnetURI;t||(t="magnet:?xt=urn:btih:"+this.torrent.infoHash,this.torrent.name&&(t+="&dn="+encodeURIComponent(this.torrent.name))),c.writeText(t),this.$q.notify(this.$t("text_copied"))},showPostInfo(){this.$emit("showPostInfo",this.torrent.fromPost)},showOriginTorrent(){this.$emit("showOriginTorrent",this.torrent)},openFile(){1===this.torrent.files.length?this.io.emit("open-external-file",this.torrent.files[0].path,this.torrent.infoHash):this.showDirectory()},showDirectory(){this.$emit("showDirectory",this.torrent)},showPaymentPannel(t){this.$emit("showPaymentPannel",{infoHash:this.torrent.infoHash,torrentName:this.torrent.name,peerId:t.id,address:t.address,remoteUser:t.user,remoteSubId:t.subId})},showQuickStart(){this.$emit("showQuickStart",this.torrent)},saveFile(t){this.$emit("saveFile",t)},saveZip(){this.$emit("saveZip")}},watch:{torrentStatus(t,e){e!==t&&this.$emit("sortByStatus")}},mounted(){this.loading=this.torrent.loading}},h=d,u=(s("cb5e"),s("2877")),p=s("f09f"),m=s("a370"),f=s("58ea"),g=s("0016"),v=s("05c0"),b=s("4e73"),y=s("1c1c"),_=s("66e5"),w=s("6b1d"),C=s("4074"),$=s("9c40"),k=s("2c91"),q=s("b498"),x=s("6a67"),S=s("7f67"),P=s("eebe"),T=s.n(P),I=Object(u["a"])(h,a,i,!1,null,"c38ea4e2",null);e["a"]=I.exports;T()(I,"components",{QCard:p["a"],QCardSection:m["a"],QCircularProgress:f["a"],QIcon:g["a"],QTooltip:v["a"],QMenu:b["a"],QList:y["a"],QItem:_["a"],QLinearProgress:w["a"],QItemSection:C["a"],QBtn:$["a"],QSpace:k["a"],QColor:q["a"],QBtnToggle:x["a"]}),T()(I,"directives",{ClosePopup:S["a"]})},"24f7":function(t,e,s){},"284d":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-12 row"},[s("q-input",{staticClass:"q-mt-sm setting-number-input",attrs:{type:"number",dense:"",outlined:"",hint:t.label,rules:t.rules},on:{blur:t.onBlur},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([t.dice?{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"casino"},on:{click:t.setRandom}},[s("q-tooltip",[t._v(t._s(t.$t("random")))])],1)]},proxy:!0}:null],null,!0),model:{value:t.number,callback:function(e){t.number=t._n(e)},expression:"number"}})],1)},i=[],n=(s("ddb0"),{props:{value:Number,keyName:String,label:String,dice:{type:Array,required:!1},rules:{type:Array,default:()=>[]},min:{type:Number,default:1}},computed:{number:{get(){return this.value},set(t){this.onChange(t)}},minValue(){return Array.isArray(this.dice)?this.dice[0]:this.min}},methods:{isValid(t){for(const e of this.rules)if("function"===typeof e){const s=e(t);if(!0!==s)return!1}return!0},onChange(t){if(""===t)return this.$emit("change",this.keyName,this.minValue);this.$emit("change",this.keyName,t)},onBlur(){this.isValid(this.value)||this.$emit("change",this.keyName,this.minValue)},setRandom(){if(!this.dice||!this.dice.length)return;const[t,e]=this.dice;return this.onChange(Math.floor(Math.random()*(e-t)+t))}}}),o=n,r=(s("b35b"),s("2877")),l=s("27f9"),c=s("0016"),d=s("05c0"),h=s("eebe"),u=s.n(h),p=Object(r["a"])(o,a,i,!1,null,"67993ab0",null);e["a"]=p.exports;u()(p,"components",{QInput:l["a"],QIcon:c["a"],QTooltip:d["a"]})},"2d04":function(t,e,s){"use strict";var a=s("1b40"),i=s("2b0e"),n=s("0613"),o=s("ff52"),r=s("0967"),l=s("2a19"),c=s("436b"),d=s("8847"),h=s("849b"),u=s("2ef0"),p=s("16ed"),m=s("a76d"),f=function(t,e,s,a){var i,n=arguments.length,o=n<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,s):a;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,s,a);else for(var r=t.length-1;r>=0;r--)(i=t[r])&&(o=(n<3?i(o):n>3?i(e,s,o):i(e,s))||o);return n>3&&o&&Object.defineProperty(e,s,o),o},g=function(t,e,s,a){function i(t){return t instanceof s?t:new s((function(e){e(t)}))}return new(s||(s=Promise))((function(s,n){function o(t){try{l(a.next(t))}catch(e){n(e)}}function r(t){try{l(a["throw"](t))}catch(e){n(e)}}function l(t){t.done?s(t.value):i(t.value).then(o,r)}l((a=a.apply(t,e||[])).next())}))};const v=!!r["b"].is.electron;let b;v&&(b=s("bdb9").ipcRenderer);let y=class extends i["a"]{constructor(){super(...arguments),this.loading=!1,this.changes=new Map,this.settings={},this.languages=p["a"],this.changed=!1}get language(){return this.settings.language}set language(t){d["b"].locale=t,v&&b.send("change-app-i18n",t),this.storeChange("language",t)}get darkMode(){return this.settings.darkMode}set darkMode(t){o["a"].set(t===m["a"].system?"auto":t===m["a"].dark),this.storeChange("darkMode",t)}t(t,...e){return d["b"].t(t,...e)}resetChange(){this.changes.clear(),this.changed=!1,this.loading=!1}storeChange(t,e){console.log(`[Setting] Set ${t} to value:`,e),this.changes.set(t,e),this.$set(this.settings,t,e),this.changed=!0}notify(t){l["a"].create({message:t,position:"bottom-right",type:"positive",timeout:2e3})}syncSetting(){return g(this,void 0,void 0,(function*(){const t=yield n["a"].dispatch("fetchSettings"),e=this.language;this.settings=Object(u["cloneDeep"])(t);const s=t.darkMode===m["a"].system;return o["a"].set(s?"auto":t.darkMode===m["a"].dark),e!==t.language&&(this.language=t.language),t}))}onSubmit(){return g(this,void 0,void 0,(function*(){if(!this.changes.size)return;this.loading=!0;const t=Object.fromEntries(this.changes);t.maximumDownloadNum&&h["a"].emit("update_torrent_settings",{maximumDownloadNum:t.maximumDownloadNum}),yield n["a"].dispatch("set",t),yield this.syncSetting(),this.resetChange(),this.notify(this.t("preferences_set_successfully"))}))}onDiscard(){return g(this,void 0,void 0,(function*(){this.changed&&(yield this.syncSetting(),this.resetChange())}))}onReset(){return g(this,void 0,void 0,(function*(){c["a"].create({title:this.t("reset"),message:this.t("reset_all_settings"),ok:{textColor:"red",color:"unset",flat:!0,label:this.t("reset")},cancel:{textColor:"unset",color:"unset",flat:!0,label:this.t("not_now")}}).onOk((()=>g(this,void 0,void 0,(function*(){this.loading=!0,yield n["a"].dispatch("resetSettings"),yield this.syncSetting(),this.resetChange(),this.notify(this.t("preferences_resetted"))}))))}))}created(){this.settings=Object(u["cloneDeep"])(n["a"].getters.settings)}beforeDestroy(){return this.onDiscard()}beforeRouteLeave(t,e,s){if(!this.changed)return s();c["a"].create({title:this.t("change_not_save"),message:this.t("discard_all_changes"),ok:this.t("stay_in_page"),cancel:this.t("discard"),persistent:!0}).onOk((()=>s(!1))).onCancel((()=>s()))}};y=f([a["a"]],y),e["a"]=y},"2de9":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{staticClass:"post-card q-my-md overflow-hidden relative-position",style:{boxShadow:"0 1px 2px rgba(0, 0, 0, 0.24)",border:t.$q.dark.isActive?"1px solid rgba(255,255,255,0.24)":"none"},on:{mouseenter:function(){return t.onCardHover(!0)},mouseleave:function(){return t.onCardHover(!1)}}},[s("img",{staticClass:"absolute-top-left",staticStyle:{filter:"blur(24px)",transform:"scale(1.25)",opacity:"0.08"},attrs:{src:t.post.image,loading:"lazy"},on:{click:t.popupImage,error:t.onImageError,load:t.onImageLoaded}}),t.post.channel?s("div",[t.hideChannel?t._e():s("q-card-section",{staticClass:"post-channel-info no-wrap overflow-hidden row items-center"},[s("div",{staticClass:"channel cursor-pointer row items-center no-wrap",on:{click:t.toChannelPage}},[s("q-avatar",{staticClass:"shadow-2",staticStyle:{background:"#282828"},attrs:{size:"18"}},[t.isLoadedChannelImage?s("img",{attrs:{src:t.post.channel.image},on:{error:t.onChannelAvatarError,load:t.onChannelAvatarLoaded}}):t._e(),t.isLoadedChannelImage?t._e():s("q-icon",{staticStyle:{color:"#ccc"},attrs:{name:"subscriptions",size:"30px"}})],1),s("div",{staticClass:"channel-title q-ml-md ellipsis-2-lines",attrs:{title:t.post.channel.title}},[t._v("\n            "+t._s(t.post.channel.title||t.$t("loading"))+"\n          ")]),t.post.channel.hidden?s("span",{staticClass:"hidden-info text-grey q-ml-xs"},[t._v("("+t._s(t.$t("private_channel"))+")")]):t._e()],1),s("q-space"),s("FollowButton",{attrs:{id:t.post.channel.id,disableFollow:t.disableFollow}})],1),s("q-separator",{directives:[{name:"show",rawName:"v-show",value:!t.hideChannel,expression:"!hideChannel"}],staticStyle:{margin:"0 -4px"}})],1):t._e(),s("q-card-section",{staticClass:"post-info row wrap q-px-none"},[s("div",{staticClass:"image q-px-sm col-xs-12 col-sm-5 row justify-center"},[s("div",{staticClass:"image-container row justify-center items-center"},[t.allowClickImage?s("img",{attrs:{src:t.post.image,loading:"lazy"},on:{click:t.popupImage,error:t.onImageError,load:t.onImageLoaded}}):t._e(),t.allowClickImage?t._e():s("q-icon",{attrs:{size:"80px",name:"video_file",color:"general"}})],1)]),s("div",{staticClass:"column post-desc overflow-hidden col-xs-12 col-sm-7 q-px-sm",staticStyle:{"flex-shrink":"1"}},[s("div",{staticClass:"desc-main column full-width items-stretch q-pr-md",staticStyle:{"flex-grow":"1"}},[s("div",{staticClass:"text-bold desc-title row overflow-hidden full-width no-wrap items-center"},[s("div",{staticClass:"post-title q-mr-sm overflow-hidden",attrs:{title:t.post.title}},[s("div",{staticClass:"text-no-wrap ellipsis"},[t._v(t._s(t.post.title))])]),s("q-space"),s("q-btn",{staticClass:"favorite-icon block",attrs:{dense:"",flat:"",color:"primary",round:"",icon:t.isFavorite?"star":"star_border"},on:{click:t.setFavorite}},[s("q-tooltip",[t._v(t._s(t.isFavorite?t.$t("remove_from_local_favorites"):t.$t("add_to_local_favorites")))])],1),t.post.channel?s("q-btn",{staticClass:"block",attrs:{dense:"",flat:"",round:"",icon:"more_vert"}},[s("q-menu",[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.follow}},[s("q-item-section",[t._v("\n                      "+t._s(t.followable?t.$t("follow"):t.$t("unfollow"))+"\n                      "+t._s(t.shortChannelTitle)+"\n                    ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.share}},[s("q-item-section",[t._v("\n                      "+t._s(t.$t("share"))+"\n                      "+t._s(t.shortChannelTitle)+"\n                    ")])],1),s("q-separator"),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.blockChannel}},[s("q-item-section",[t._v("\n                      "+t._s(t.isBlocked?t.$t("unblock"):t.$t("block"))+"\n                      "+t._s(t.shortChannelTitle)+"\n                    ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:t.blockUser}},[s("q-item-section",[t._v(t._s(t.isBlockedUser?t.$t("unblock_creator"):t.$t("block_creator")))])],1)],1)],1)],1):t._e()],1),s("div",{staticClass:"text-subtitle2 q-mt-xs text-grey desc-time"},[s("span",[t._v(t._s(new Date(t.post.timestamp).toLocaleString()))]),s("q-badge",{staticClass:"q-ml-md",attrs:{color:"primary","text-color":"white"}},[t._v("\n              "+t._s(t.post.rate||"G")+"\n              "),s("q-tooltip",t._l(t.getRateText(t.post.rate).split("\n"),(function(e,a){return s("div",{key:a,staticClass:"rate-tip"},[t._v(t._s(e))])})),0)],1)],1),s("div",{staticClass:"text description q-mt-sm",class:{large:t.hideButtons},staticStyle:{height:"480px","margin-right":"-8px"}},[s("q-scroll-area",{staticStyle:{height:"244px"}},t._l((t.post.description||"").split("\n"),(function(e,a){return s("div",{key:a,staticClass:"desc-para q-pr-md"},[t._v(t._s(e))])})),0)],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.hideButtons,expression:"!hideButtons"}],staticClass:"text-center post-buttons q-mt-md q-mr-md"},[t.post.abUrl||t.backAbUrl?s("div",{staticClass:"download-btns"},[t.addedStatus?s("q-btn",{staticClass:"q-px-sm",attrs:{unelevated:"",dense:"",flat:"",ripple:!1,label:"downloading"===t.addedStatus?t.$t("downloading"):t.$t("completed"),icon:"downloading"===t.addedStatus?"download":"done",color:"primary"},on:{click:t.toTaskInfo}},[s("q-tooltip",[t._v(t._s(t.$t("lib_already_added"))),s("br"),t._v(t._s(t.$t("click_to_task")))])],1):s("q-btn",{staticClass:"q-px-sm",attrs:{unelevated:"",dense:"",label:t.$t("download"),icon:"download",color:"primary"},on:{click:t.download}}),t.playFile?s("q-btn",{staticClass:"q-ml-sm q-px-sm",attrs:{unelevated:"",dense:"",label:t.$t("play"),icon:"play_arrow",color:"primary"},on:{click:t.play}}):s("q-btn",{staticClass:"q-ml-sm q-px-sm",attrs:{unelevated:"",dense:"",label:t.$t("play_while_downloading"),icon:"ondemand_video",color:"primary"},on:{click:t.triggerPlay}})],1):s("div",{staticClass:"no-ab-url"},[s("q-btn",{attrs:{unelevated:"",dense:"",disable:"",label:"No download url"}})],1)])])])],1)},i=[],n=(s("5319"),s("e01a"),s("0613")),o=s("ed08"),r=s("c428"),l=s("71ac"),c=s("4aad"),d=s("849b"),h=s("bae3"),u=s("cdde"),p=s("20fc"),m=s("826a"),f=s("a939");const g=t=>new Promise((e=>setTimeout(e,t)));var v={name:"PostCard",inject:["rootApp","io"],components:{FollowButton:f["a"]},props:{post:{type:Object,required:!0},hideChannel:{type:Boolean},hideButtons:{type:Boolean},disableFollow:{type:Boolean}},data(){return{postCardHover:!1,allowClickImage:!0,animating:!1,followBtnHover:!1,pending:!1,favoriteNotifyFns:[],backAbUrl:"",isLoadedChannelImage:!0,isFavorite:l["a"].isFavorite(this.post.id)}},computed:{followable(){return!c["a"].followingChannels.find((t=>{var e;return t.id===(null===(e=this.post.channel)||void 0===e?void 0:e.id)}))},isBlocked(){var t,e;return null===(t=c["a"].userData.blockChannels)||void 0===t?void 0:t.includes(null===(e=this.post.channel)||void 0===e?void 0:e.id)},isBlockedUser(){var t,e;return null===(t=c["a"].userData.blockUsers)||void 0===t?void 0:t.includes(null===(e=this.post.channel)||void 0===e?void 0:e.creator)},followBtnLabel(){return this.followable?this.$t("follow"):this.followBtnHover?this.$t("unfollow"):this.$t("following")},abKey(){const t=this.post.abUrl||this.backAbUrl;return t?Object(r["a"])(t.includes("://")?t:decodeURIComponent(t)):""},addedStatus(){var t;return(null===(t=c["a"].addedPostMap[this.abKey])||void 0===t?void 0:t.type)||!1},shortChannelTitle(){return this.post.channel&&this.post.channel.title?this.post.channel.title.length>12?this.post.channel.title.substring(0,10)+"...":this.post.channel.title:""},playFile(){var t;return null===(t=c["a"].addedPostMap[this.abKey])||void 0===t?void 0:t.playFile},settings(){var t,e;const s=(null===(t=this.post)||void 0===t||null===(e=t._)||void 0===e?void 0:e["#"])||this.post.soul,a=n["a"].state.setting,i={downloadDirectory:a.downloadDirectory,uploadSpeed:a.uploadSpeed,downloadSpeed:a.downloadSpeed,maximumDownloadNum:a.maximumDownloadNum,maximumConnectionsNum:a.maximumConnectionsNum,payedUserShareRadix:a.payedUserShareRadix,trackers:a.trackerList||[],postTitle:Object(h["a"])(this.post.title)};return s&&(i.fromPost=s),i}},methods:{onCardHover(t){this.postCardHover=t},getRateText(t="G"){switch(t){case"G":return this.$t("rate_g_desc");case"PG":return this.$t("rate_pg_desc");case"PG-13":return this.$t("rate_pg_13_desc");case"R":return this.$t("rate_r_desc");case"NC-17":return this.$t("rate_nc_17_desc")}return this.$t("rate_g_desc")},confirm(t,e={ok:"",cancel:"",message:""}){const s={title:t,ok:e.ok||this.$t("ok"),cancel:e.cancel||this.$t("cancel")};return e.message&&(s.message=e.message),new Promise((t=>{this.$q.dialog(s).onOk((()=>t(!0))).onDismiss((()=>t(!1)))}))},popupImage(){console.log("popup",this.allowClickImage),this.allowClickImage&&this.$emit("preview",this.post.image)},async playAnimation(t,e="#downloading"){if(this.animating)return;this.animating=!0;const s=document.querySelector(e),a=s?s.getBoundingClientRect():{x:t.clientX,y:t.clientY,width:0,height:0},i={left:t.clientX-36+"px",top:t.clientY-36+"px"},n={left:a.x+a.width/3-36+"px",top:a.y+a.height/2-36+"px"},o=document.createElement("i");o.classList.add("q-icon","material-icons","text-primary"),o.innerHTML="video_file",o.style.position="absolute",o.style.fontSize="72px",o.style.left=i.left,o.style.top=i.top,o.style.opacity=0,o.style.transform="scale(2.5)",o.style.transition="0.4s ease",document.body.appendChild(o),await g(0),o.style.opacity=1,o.style.transform="scale(1)",await g(500),o.style.transition="1s ease",o.style.left=n.left,o.style.top=n.top,o.style.transform="scale(0.5)",o.style.opacity=0,await g(600),this.animating=!1,document.body.removeChild(o)},async triggerPlay(t){if(!n["a"].getters.accountUserInfo||!n["a"].getters.accountUserInfo.sub)return this.$q.dialog({title:"Login to continue",message:"You need to login for downloading",ok:!0});const e=this.post.abUrl||this.backAbUrl,a=e.includes(":")?e:decodeURIComponent(e);if("string"!==typeof a||!a.startsWith("ab://")&&!a.startsWith("alphabiz://")&&!a.startsWith("magnet:"))return this.$q.notify(this.$t("invalid_download_url")+": "+a);if(!Object(o["isElectron"])()){const t=s("ac4e").wtClient;if(t.torrents[0]){const e=s("34f8").default;if(this.addedStatus)return e();const a=await this.confirm("Remove old task?",{message:"You can only download one task at one time. Do you want to remove old one?"});if(!a)return;t.torrents[0]&&await new Promise((e=>{t.torrents[0].destroy(e)}))}}this.playAnimation(t,"#drawer-player"),await g(600);const i=a.startsWith("ab://")?a.replace(/^ab:\/\//,`alphabiz://${encodeURIComponent(this.post.title)}/`):a;if(this.io.emit("download-and-play",{type:"magnet",url:i,token:i,...this.settings}),Object(o["isElectron"])()){var r;const t=await Object(p["a"])(i);if(!t)return;const e=null===(r=t.match(/([0-9a-fA-F]{40})/))||void 0===r?void 0:r[1];e&&n["a"].dispatch("remotePlay",e)}else{const{default:t}=s("34f8"),{wtClient:e}=s("ac4e"),a=setInterval((()=>{e.torrents.length&&(clearInterval(a),t())}),100)}},async download(t){if(!n["a"].getters.accountUserInfo||!n["a"].getters.accountUserInfo.sub)return this.$q.dialog({title:"Login to continue",message:"You need to login for downloading",ok:!0});const e=this.post.abUrl||this.backAbUrl,a=e.includes(":")?e:decodeURIComponent(e);if("string"!==typeof a||!a.startsWith("ab://")&&!a.startsWith("alphabiz://")&&!a.startsWith("magnet:"))return this.$q.notify(this.$t("invalid_download_url")+": "+a);const i=a.startsWith("ab://")?a.replace(/^ab:\/\//,`alphabiz://${encodeURIComponent(this.post.title)}/`):a;console.log(i);const r={type:"url",url:i,token:i,...this.settings};if(!Object(o["isElectron"])()){const t=s("ac4e").wtClient;if(t.torrents[0]){const e=s("34f8").default;if(this.addedStatus)return e();const a=await this.confirm(this.$t("remove_old_task"),{message:this.$t("remove_old_task_desc")});if(!a)return;t.torrents[0]&&await new Promise((e=>{t.torrents[0].destroy(e)}))}}this.io.emit("download_torrent",r),this.playAnimation(t,Object(o["isElectron"])()?"#downloading":"#task-management")},checkChannel(){var t;const e=null===(t=this.post.channel)||void 0===t?void 0:t.id,s=c["a"].channelList.find((t=>t.id===e));return!(!e||!s)||(this.$q.dialog({title:this.$t("channel_not_found"),message:this.$t("cannot_get_channel_info"),ok:this.$t("ok")}),!1)},async follow(){if(this.pending)return;if(!this.checkChannel())return;const t=this.post.channel.id,e=!c["a"].followingChannels.find((e=>e&&e.id===t));if(!e){const t=await new Promise((t=>{this.$q.dialog({title:this.$t("unfollow"),message:this.$t("unfollow_confirm"),ok:this.$t("unfollow"),cancel:this.$t("cancel")}).onOk((()=>t(!1))).onDismiss((()=>t(!0)))}));if(t)return}this.pending=!0,setTimeout((()=>{!c["a"].followingChannels.find((e=>e.id===t))===e&&(console.log("follow failed!",t,e),e?c["a"].followChannel(t):c["a"].unfollowChannel(t)),this.pending=!1}),2e3),console.log("follow click",e),e?c["a"].followChannel(t):c["a"].unfollowChannel(t)},async share(){if(!this.checkChannel())return;const t=`ab-library://channel/${Object(h["a"])(this.post.channel.title)}/${this.post.channel.id}`;console.log("share",t);const e=await Object(p["a"])(t);if(console.log("converted url"),!e)return this.$q.notify(this.$t("uri_copy_failed"));Object(u["a"])(e).then((()=>{this.$q.notify(this.$t("copied"))}))},async blockChannel(){if(!this.checkChannel())return;if(console.log("block channel",this.post.channel.id,this.isBlocked),this.isBlocked)return c["a"].unblockChannel(this.post.channel.id).then((t=>{console.log("unblock channel result",t)}));const t=await this.confirm(this.$t("block_channel"),{message:this.$t("block_channel_confirm"),ok:this.$t("block")});t&&c["a"].blockChannel(this.post.channel.id).then((t=>{console.log("block channel result",t)}))},async blockUser(){var t;if(console.log("block user",null===(t=this.post.channel)||void 0===t?void 0:t.creator,this.isBlockedUser),!this.post.channel||!this.post.channel.creator)return;if(this.isBlockedUser)return c["a"].unblockUser(this.post.channel.creator).then((t=>{console.log("unblock user result",t)}));const e=await this.confirm(this.$t("block_creator"),{message:this.$t("block_creator_confirm"),ok:this.$t("block")});e&&c["a"].blockUser(this.post.channel.creator).then((t=>{console.log("block user result",t)}))},toChannelPage(){this.checkChannel()&&this.$emit("to-channel",this.post.channel)},toTaskInfo(){var t;const e=null===(t=this.post.channel)||void 0===t?void 0:t.soul;let s=`/downloader?currentTab=${this.addedStatus}&abKey=${this.abKey}`;e&&(s+=`&channel=${encodeURIComponent(e)}`),this.post.id&&(s+=`&postId=${this.post.id}`),e&&this.post.id&&(s+=`&soul=${encodeURIComponent(e+"/posts/"+this.post.id)}`),console.log("to",this.abKey,this.addedStatus,e,this.post.id),console.log(s),this.$router.push(s)},setFavorite(){const t=this.post.id;var e,s,a,i,n,o,r,c,d,h,u,p,m,f,g;this.isFavorite?l["a"].remove({id:t},(()=>{this.isFavorite=l["a"].isFavorite(t)})):l["a"].add({id:this.post.id,title:this.post.title,description:this.post.description,image:this.post.image,abUrl:this.post.abUrl||this.backAbUrl,soul:null===(e=this.post)||void 0===e||null===(s=e._)||void 0===s?void 0:s["#"],channel:{id:null===(a=this.post)||void 0===a||null===(i=a.channel)||void 0===i?void 0:i.id,title:null===(n=this.post)||void 0===n||null===(o=n.channel)||void 0===o?void 0:o.title,description:null===(r=this.post)||void 0===r||null===(c=r.channel)||void 0===c?void 0:c.description,image:null===(d=this.post)||void 0===d||null===(h=d.channel)||void 0===h?void 0:h.image,soul:null===(u=this.post)||void 0===u||null===(p=u.channel)||void 0===p||null===(m=p._)||void 0===m?void 0:m["#"],creator:null===(f=this.post)||void 0===f||null===(g=f.channel)||void 0===g?void 0:g.creator}});this.isFavorite=l["a"].isFavorite(t)},play(){if(!Object(o["isElectron"])()&&this.addedStatus){const t=s("34f8").default;return t()}const{infoHash:t,playFile:e}=c["a"].addedPostMap[this.abKey]||{};console.log("play",t,e);const a=e.path||e;n["a"].dispatch("remotePlay",t),d["a"].emit("play-torrent",{infoHash:t,filepath:a})},onChannelAvatarError(){this.isLoadedChannelImage=!1},onChannelAvatarLoaded(t){t.target.src===this.post.channel.image&&(this.isLoadedChannelImage=!0)},onImageError(){this.allowClickImage=!1},onImageLoaded(t){t.target.src===this.post.image&&(this.allowClickImage=!0)}},activated(){var t,e;this.post.abUrl||(console.log("no aburl",{...this.post}),null!==(t=this.post)&&void 0!==t&&null!==(e=t.channel)&&void 0!==e&&e.soul&&this.post.id&&m["v"].get(this.post.channel.soul+"/posts/"+this.post.id).on(((t,e,s,a)=>{t&&t.abUrl&&(console.log("Get abUrl for",this.post.id,t.abUrl),this.backAbUrl=t.abUrl,a.off())})));this.isFavorite=l["a"].isFavorite(this.post.id)}},b=v,y=(s("af2c"),s("2877")),_=s("f09f"),w=s("a370"),C=s("cb32"),$=s("0016"),k=s("2c91"),q=s("eb85"),x=s("9c40"),S=s("05c0"),P=s("4e73"),T=s("1c1c"),I=s("66e5"),O=s("4074"),U=s("58a8"),j=s("4983"),A=s("7f67"),B=s("eebe"),L=s.n(B),R=Object(y["a"])(b,a,i,!1,null,"4d929a7c",null);e["a"]=R.exports;L()(R,"components",{QCard:_["a"],QCardSection:w["a"],QAvatar:C["a"],QIcon:$["a"],QSpace:k["a"],QSeparator:q["a"],QBtn:x["a"],QTooltip:S["a"],QMenu:P["a"],QList:T["a"],QItem:I["a"],QItemSection:O["a"],QBadge:U["a"],QScrollArea:j["a"]}),L()(R,"directives",{ClosePopup:A["a"]})},"2e03":function(t,e,s){},"2e92":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-select",{staticClass:"setting-select",class:{caption:t.caption},attrs:{value:t.displayLabel,options:t.options,label:t.label,outlined:"",dense:"","emit-value":"","data-cy":"select-direct"},on:{input:t.emitChange},scopedSlots:t._u([t.caption?{key:"option",fn:function(e){return[s("q-item",t._g(t._b({},"q-item",e.itemProps,!1),e.itemEvents),[s("q-item-section",[s("q-item-label",{domProps:{innerHTML:t._s(e.opt.label)}}),e.opt.caption?s("q-tooltip",t._l(e.opt.caption.split("\n"),(function(e,a){return s("span",{key:a,staticClass:"tooltip"},[t._v(t._s(e))])})),0):t._e()],1)],1)]}}:null],null,!0)})},i=[],n=(s("ddb0"),{model:{prop:"value",event:"change"},props:{value:String,options:Array,label:String,caption:Boolean},computed:{displayLabel(){for(const t of this.options)if(t.value===this.value)return t.label;return this.value}},methods:{emitChange(t){this.$emit("change",t)}}}),o=n,r=(s("e38a"),s("2877")),l=s("ddd8"),c=s("66e5"),d=s("4074"),h=s("0170"),u=s("05c0"),p=s("eebe"),m=s.n(p),f=Object(r["a"])(o,a,i,!1,null,"58d8362a",null);e["a"]=f.exports;m()(f,"components",{QSelect:l["a"],QItem:c["a"],QItemSection:d["a"],QItemLabel:h["a"],QTooltip:u["a"]})},3373:function(t,e,s){},"34f8":function(t,e,s){"use strict";s.r(e),s.d(e,"default",(function(){return m}));s("5319"),s("d9e2");var a=s("ac4e"),i=s("2a19"),n=s("a18c"),o=s("8847"),r=s("0613"),l=s("f0e2"),c=s("9176"),d=s("f880");const h=()=>{const t=l["default"].getAllPlayers();return Array.isArray(t)?t[0]:null},u=()=>{const t=()=>(a["wtClient"].torrents[0]&&a["wtClient"].torrents[0].files&&a["wtClient"].torrents[0].files.forEach((t=>{t._serviceWorker&&"activated"===t._serviceWorker.state||(t._serviceWorker=a["wtClient"].serviceWorker)})),!0);if(a["wtClient"].serviceWorker&&"activated"===a["wtClient"].serviceWorker.state){if("activated"===a["wtClient"].serviceWorker.state)return t();a["wtClient"].serviceWorker=null}if(!navigator.serviceWorker||!navigator.serviceWorker.controller)return!1;const e=navigator.serviceWorker.controller;return"activated"===e.state&&(a["wtClient"].loadWorker(e),t())};let p=null;function m(t){if("string"===typeof t&&t.startsWith("/webtorrent/")&&(t=t.replace("/webtorrent/","")),c["player"].toggleSplash(!1),!u())return void i["a"].create(o["b"].t("service_worker_error"));if(!a["wtClient"].torrents[0])return void i["a"].create(o["b"].t("add_task_first"));let e=!1;const s=Date.now();Object(n["b"])().push("/player"),p&&clearInterval(p),c["player"].toggleSplash(!0,o["b"].t("loading")),p=setInterval((async()=>{if(e)return;if(Date.now()-s>3e4&&!a["wtClient"].torrents[0].ready)return c["player"].toggleSplash(!1),i["a"].create(o["b"].t("player_task_time")),void clearInterval(p);if(a["wtClient"].torrents[0]&&!a["wtClient"].torrents[0].files[0])return void c["player"].toggleSplash(!0,o["b"].t("loading"));{const t=a["wtClient"].torrents[0].files[0],e=Object(d["a"])(t.downloaded||0),s=Object(d["a"])(t.length||0),i=`(${e}/${s})`;if(c["player"].toggleSplash(!0,o["b"].t("downloading")+"... "+i),a["wtClient"].torrents[0].pieces[t._startPiece]||a["wtClient"].torrents[0].pieces[t._startPiece+1])return void console.log("Wait for first two pieces downloaded")}const n=document.querySelector("#my-video video");if(!n)return;try{const s=h();if(t||(t=a["wtClient"].torrents[0].files[0].path),4===s.readyState()){const e=`${location.origin}/webtorrent/${a["wtClient"].torrents[0].infoHash}/${encodeURI(t)}`;if(console.log(e,s.src(),e===s.src()),s.src()!==e)throw s.hasStarted(!1),new Error("Reset since src changed");return console.log(s.readyState(),"ready"),s.setAttribute("muted",!0),s.setAttribute("playsInline",!0),s.setAttribute("autoplay",!1),c["player"].toggleSplash(!1),void clearInterval(p)}if(e)return}catch(u){console.log("cannot get vjs",u)}if(e)return;const l=a["wtClient"].torrents[0].files.find((e=>t===e.path));if(n.setAttribute("playsInline",!0),n.setAttribute("muted",!0),n.setAttribute("autoplay",!1),l){console.log("Play file",t,l);const e=`${location.origin}/webtorrent/${a["wtClient"].torrents[0].infoHash}/${encodeURI(l.path||l.name)}`;r["a"].commit("CURRENT_VIDEO_URL_MUTATION",e),r["a"].commit("UPDATE_VIDEO_UPDATE_PLAYER_MUTATION",!0),setTimeout((()=>{const t=h();t&&4===t.readyState()&&t.paused()&&i["a"].create(o["b"].t("autoplay_hint"))}),3e3)}else{const t=a["wtClient"].torrents[0].files[0];console.log("Cannot find same file. Use files[0]",t.path);const e=`${location.origin}/webtorrent/${a["wtClient"].torrents[0].infoHash}/${encodeURI(t.path||t.name)}`;r["a"].commit("CURRENT_VIDEO_URL_MUTATION",e),r["a"].commit("UPDATE_VIDEO_UPDATE_PLAYER_MUTATION",!0),setTimeout((()=>{const t=h();t&&4===t.readyState()&&t.paused()&&i["a"].create(o["b"].t("autoplay_hint"))}),3e3)}c["player"].toggleSplash(!1),e=!0}),1e3)}},"39a2":function(t,e,s){"use strict";s("46ae")},"426d":function(t,e,s){"use strict";s("2e03")},"46ae":function(t,e,s){},"48e1":function(t,e,s){},"52af":function(t,e,s){},"5db0":function(t,e,s){"use strict";s("637e")},"5ea8":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-card",{staticClass:"channel-card column relative-position overflow-hidden rounded-borders",style:{border:t.$q.dark.isActive?"1px solid rgba(255,255,255,0.24)":"none"},attrs:{flat:""}},[s("q-img",{staticClass:"channel-image absolute-top-left full-height",staticStyle:{filter:"blur(24px) saturate(1.5)",opacity:"0.2",transform:"scale(1.25)"},attrs:{src:t.image,ratio:1,"placeholder-src":"platform-assets/windows/icon/Wide310x150Logo.scale-240.png"}}),s("div",{staticClass:"image-container overflow-hidden",staticStyle:{"border-top-left-radius":"4px!important","border-top-right-radius":"4px!important"}},[s("q-img",{staticClass:"channel-image cursor-pointer",attrs:{contain:"",src:t.image,ratio:1},on:{click:t.detail,error:t.onImageError},scopedSlots:t._u([{key:"error",fn:function(){return[s("div",{staticClass:"absolute-bottom"},[s("div",{staticClass:"text-h6"},[s("q-icon",{attrs:{name:"video_library"}}),t._v("\n            "+t._s(t.title)+"\n          ")],1)]),s("q-tooltip",[t._v(t._s(t.editable?t.$t("edit_posts"):t.$t("channel_detail")))])]},proxy:!0}])},[t.image&&t.isHaveImage?t._e():s("q-icon",{staticClass:"absolute-center",staticStyle:{color:"#ccc"},attrs:{size:"90px",name:"subscriptions"}}),s("div",{staticClass:"absolute-bottom"},[s("div",{staticClass:"text-h6"},[t._v("\n          "+t._s(t.title)+"\n        ")])]),s("q-tooltip",[t._v(t._s(t.editable?t.$t("edit_posts"):t.$t("channel_detail")))])],1)],1),s("q-card-section",{staticClass:"q-py-none",staticStyle:{overflow:"visible"}},[s("div",{staticClass:"q-pa-none row",staticStyle:{margin:"0 -16px"}},[s("div",{staticClass:"q-py-sm q-px-sm q-pl-md",attrs:{"data-cy":"channel-ID"}},[t._v("ID: "+t._s(t.id))]),s("q-space"),s("q-btn",{staticClass:"q-py-xs q-px-sm",attrs:{unelevated:"",icon:"content_copy",size:"xs",dense:""},on:{click:t.copyId}})],1),s("div",{staticClass:"q-px-md channel-desc",staticStyle:{margin:"0 -16px"}},[t._v(t._s(t.description))]),s("div",{staticClass:"channel-tags",staticStyle:{margin:"4px -4px 0"}},[t.isBlocked?s("q-badge",{staticClass:"q-ma-xs q-py-xs",attrs:{color:"negative","text-color":"negative"}},[t._v(t._s(t.$t("blocked")))]):t._e(),t.hidden?s("q-badge",{staticClass:"q-ma-xs q-py-xs",attrs:{color:"general","text-color":"general"}},[t._v(t._s(t.$t("private_channel")))]):t._e()],1)]),s("q-space"),t.hideFollow?s("q-card-actions",[t.editable?s("q-btn",{attrs:{flat:"",icon:"delete",color:"negative"},on:{click:function(e){return e.stopPropagation(),t.remove.apply(null,arguments)}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[t._v(t._s(t.$t("remove_channel"))+"\n      ")])],1):t._e(),s("q-space"),t.editable?s("q-btn",{attrs:{flat:"",icon:"edit"},on:{click:function(e){return e.stopPropagation(),t.detail.apply(null,arguments)}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[t._v(t._s(t.$t("edit_channel"))+"\n      ")])],1):t._e(),t.editable?s("q-btn",{attrs:{flat:"",icon:"find_in_page"},on:{click:function(e){return e.stopPropagation(),t.preview.apply(null,arguments)}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[t._v(t._s(t.$t("preview"))+"\n      ")])],1):t._e(),t.editable?s("q-btn",{attrs:{flat:"",icon:"settings"},on:{click:function(e){return e.stopPropagation(),t.edit.apply(null,arguments)}}},[s("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle",offset:[10,10]}},[t._v(t._s(t.$t("channel_setting"))+"\n      ")])],1):t._e()],1):s("q-card-actions",{staticClass:"flex justify-center items-center"},[s("FollowButton",{staticClass:"q-my-sm",attrs:{id:t.id}})],1)],1)},i=[],n=s("cdde"),o=s("4aad"),r=s("a939"),l={name:"ChannelCard",components:{FollowButton:r["a"]},data(){return{isHaveImage:!0}},props:{title:{type:String,required:!0},description:{type:String,required:!0},image:{type:String,required:!0},id:{type:String,default:""},soul:{type:String,default:""},hidden:{type:Boolean},editable:{type:Boolean},hideFollow:{type:Boolean},followable:{type:Boolean}},watch:{image(t,e){t&&t!==e&&(this.isHaveImage=!0)}},computed:{isBlocked(){return o["a"].userData.blockChannels.includes(this.id)}},methods:{copyId(){Object(n["a"])(this.id).then((()=>{this.$q.notify(this.$t("copied_to_clipboard"))}))},edit(){this.editable&&this.$emit("edit",this.id)},detail(){this.$emit("detail",this.id)},onImageError(){this.isHaveImage=!1},preview(){this.$emit("preview",this.id)},follow(){this.$emit("follow",this.id)},remove(){this.$emit("remove-channel",this.id)}}},c=l,d=(s("959b"),s("2877")),h=s("f09f"),u=s("068f"),p=s("0016"),m=s("05c0"),f=s("a370"),g=s("2c91"),v=s("9c40"),b=s("58a8"),y=s("4b7e"),_=s("eebe"),w=s.n(_),C=Object(d["a"])(c,a,i,!1,null,"458a00eb",null);e["a"]=C.exports;w()(C,"components",{QCard:h["a"],QImg:u["a"],QIcon:p["a"],QTooltip:m["a"],QCardSection:f["a"],QSpace:g["a"],QBtn:v["a"],QBadge:b["a"],QCardActions:y["a"]})},"5fe5":function(t,e,s){"use strict";s("66c8")},6277:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"search-channel"},[s("div",{staticClass:"fixed-bottom-right show-search-channel",class:{higher:t.higher}},[s("q-btn",{staticClass:"channel-search-btn q-ma-xs",class:{hide:t.hide},attrs:{fab:"","no-wrap":"",size:"18px",color:"primary",icon:"library_add"},on:{click:function(e){t.showDialog=!0}}},[s("div",{staticClass:"fab-inner-text"},[t._v(t._s(t.$t("search")))])])],1),s("q-dialog",{on:{hide:t.clearInput},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[s("q-card",{staticClass:"search-dialog overflow-hidden"},[s("q-card-section",{staticClass:"column items-stretch q-pa-sm",staticStyle:{overflow:"visible"}},[s("div",{staticClass:"q-mt-xs flex items-center"},[s("div",{staticClass:"text-h6 text-weight-bold q-mt-xs"},[t._v(t._s(t.$t("search_for_channel")))]),s("q-space"),s("q-btn",{attrs:{flat:"",round:"",icon:"close",color:"negative"},on:{click:function(e){t.showDialog=!1}}})],1),s("div",{staticClass:"search-textfield q-mt-sm"},[s("q-input",{attrs:{type:"text",outlined:"",dense:"",autofocus:"",label:this.$t("channel")+" ID",placeholder:"%abcd1234"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search.apply(null,arguments)}},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{color:"primary",name:"search"},on:{click:t.search}})]},proxy:!0}]),model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})],1),s("q-scroll-area",{staticClass:"items-center",staticStyle:{height:"calc(100vh - 256px)",margin:"4px auto 0",width:"100%"}},[s("div",{staticClass:"search-results full-width flex justify-center items-stretch"},[t._l(t.searchResults,(function(e){return s("ChannelCard",t._b({key:e.id,attrs:{followable:!t.lib.followingChannels.find((function(t){return t.id===e.id}))},on:{detail:t.detail,follow:t.follow}},"ChannelCard",e,!1))})),s("i"),s("i"),s("i"),s("i"),s("i"),s("i"),s("i"),s("i")],2)])],1)],1)],1)],1)},i=[],n=(s("498a"),s("5319"),s("4aad")),o=s("5ea8"),r={name:"SearchChannel",props:{higher:Boolean},components:{ChannelCard:o["a"]},data(){return{hide:!1,showDialog:!1,searchText:"",searchResults:[],lib:n["a"]}},methods:{clearInput(){this.searchText="",this.searchResults=[]},search(){if(console.log("search",this.searchText),!this.searchText||!this.searchText.trim())return this.$q.dialog({message:this.$t("please_input_channel_id"),ok:this.$t("ok")});const t=this.searchText.trim().replace(/^%/,""),e=n["a"].allChannelList.filter((e=>!!(e&&e.title&&e.id)&&(e.hidden?e.id===t:e.id.includes(t))));this.searchResults=e,e.length||this.$q.dialog({message:this.$t("search_channel_no_result",[t]),ok:this.$t("ok")})},follow(t){const e=!n["a"].followingChannels.find((e=>e.id===t));if(e)return n["a"].followChannel(t);this.$q.dialog({title:this.$t("unfollow"),message:this.$t("unfollow_confirm"),ok:this.$t("unfollow"),cancel:this.$t("cancel")}).onOk((()=>{n["a"].unfollowChannel(t)}))},detail(t){const e=n["a"].allChannelList.find((e=>e.id===t&&e.title&&e.creator));if(!e)return this.$q.dialog({title:this.$t("channel_not_found"),message:this.$t("cannot_get_channel_info"),ok:this.$t("ok")});console.log("find ch",e);const s=["id","title"].map((t=>{const s=e[t];return t+"="+encodeURIComponent(s)})).join("&"),a=`/library/channel?${s}`;this.$root.$emit("navigate-to",a),this.$router.push(a)}},activated(){this.hide=!0,setTimeout((()=>{this.hide=!1}),300)},deactivated(){this.hide=!0,this.clearInput()}},l=r,c=(s("5fe5"),s("2877")),d=s("9c40"),h=s("24e8"),u=s("f09f"),p=s("a370"),m=s("2c91"),f=s("27f9"),g=s("0016"),v=s("4983"),b=s("eebe"),y=s.n(b),_=Object(c["a"])(l,a,i,!1,null,"229def7c",null);e["a"]=_.exports;y()(_,"components",{QBtn:d["a"],QDialog:h["a"],QCard:u["a"],QCardSection:p["a"],QSpace:m["a"],QInput:f["a"],QIcon:g["a"],QScrollArea:v["a"]})},"637e":function(t,e,s){},"64f1":function(t,e,s){"use strict";(function(t,a){s("5319");var i=s("839e"),n=s.n(i),o=s("b843"),r=s.n(o),l=s("f880"),c=s("ed08"),d=s("0613");let h=null;Object(c["isElectron"])()&&(h=t["require"]("geoip-country")),e["a"]={props:{peer:{type:Object,required:!0}},computed:{isDevMode(){return d["a"].getters.isDevMode},country(){const t=this.peer.addresses[0];if(!t)return"";try{const e=h.lookup(t);return e&&e.country?e.country:""}catch(e){return""}},countryFlag(){return this.country?n.a.getEmojiFlag(this.country):""},uploadSpeed(){return Object(l["a"])(this.peer.uploadSpeed,{byte:!1,gb:!1})},downloadSpeed(){return Object(l["a"])(this.peer.downloadSpeed,{byte:!1,gb:!1})},peerClient(){if(!this.peer.id)return"-";const t=a.from(this.peer.id,"hex").toString("ascii");try{const e=r()(t.replace("-AB","-WD")),s=this.peer.isAbPeer?"(Alphabiz)WebTorrent":e.client;return"unknown"===s?this.$t("unknown"):e.version?s+" "+e.version:s}catch(e){return this.$t("unknown")}},peerProgress(){if("number"!==typeof this.peer.progress)return"-";const t=Number((100*this.peer.progress).toFixed(1));return t+"%"}},methods:{showPaymentPannel(){this.$emit("showPaymentPannel",{peerId:this.peer.id,address:this.peer.address,remoteUser:this.peer.user,remoteSubId:this.peer.subId})}}}}).call(this,s("c8ba"),s("1c35").Buffer)},"665a":function(t,e,s){},"66c8":function(t,e,s){},"71ac":function(t,e,s){"use strict";s("e9c4"),s("ddb0");var a=s("9649"),i=s("2a19"),n=s("8847");console.log("===",n["b"]);const o={_store:null,store:{favorites:[],ids:[]},_preNotify:null,_init(){if(Object(a["a"])()){const t=s("63a9");this._store=new t({name:"favorite",defaults:{favorites:[]}}),this.store=this._store.store}else{const t="ab-local-favorites",e=localStorage.getItem(t);this.store=e?JSON.parse(e):{favorites:[],ids:[]};const s=this.store;this._store={get(t){return console.log("get",t,s),s[t]},set(e,a){console.log("set",e,a,s),s[e]=a,localStorage.setItem(t,JSON.stringify(s))}}}this.store.ids=this.store.favorites.map((t=>t.id))},set(t){for(const e of t)this.add(e)},add(t){if(this.store.ids.find((e=>e===t.id)))return;t.timestamp||(t.timestamp=Date.now());let e=0;for(const s of this.store.favorites){if(!(s.timestamp>t.timestamp))break;e++}this.store.favorites.splice(e,0,t),this.store.ids.splice(e,0,t.id),this._store.set("favorites",this.store.favorites)},remove(t,e){const s="string"===typeof t?t:t.id,a=this.store.ids.findIndex((t=>t===s));if(-1===a)return;const[r]=this.store.favorites.splice(a,1);if(this.store.ids.splice(a,1),this._store.set("favorites",this.store.favorites),!r)return;const l=i["a"].create({message:n["b"].t("removed_favorite")+r.title,group:!1,actions:[{label:n["b"].t("undo"),handler(){o.add(r),e&&e(r)}}]});this._preNotify&&this._preNotify(),this._preNotify=l},list(){return this.store.favorites.sort(((t,e)=>e.timestamp-t.timestamp))},isFavorite(t){return this.store.ids.includes(t)}};o._init(),e["a"]=o},9176:function(t,e,s){"use strict";s.r(e),s.d(e,"player",(function(){return K}));var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticStyle:{position:"relative"}},[s("input",{ref:"file",staticStyle:{display:"none"},attrs:{id:"media-file-upload",type:"file","data-cy":"file-input"},on:{input:t.manualAddFile}}),s("input",{ref:"subtitle",staticStyle:{display:"none"},attrs:{type:"file",accept:".srt,.vtt"},on:{input:t.manualAddSubtitle}}),s("div",{staticStyle:{position:"absolute",height:"100%",width:"100%"},attrs:{id:"video-container",lang:t.lang}},[s("video",{ref:"video",staticClass:"video-js vjs-default-skin vjs-16-9 vjs-big-play-centered vjs-fluid",staticStyle:{height:"100%"},attrs:{crossorigin:"anonymous",id:"my-video"}})]),s("audio-info",{attrs:{show:t.isAudio}}),s("video-splash",{attrs:{show:t.showSplash,videoLoadingHint:t.videoLoadingHint}}),s("advanced-options",{attrs:{show:t.showAdvancedOptions,advancedOptions:t.advancedOpt},on:{close:function(){return t.toggleAdvancedOptions(!1)}}})],1)},i=[],n=(s("ddb0"),s("5319"),s("2b3d"),s("9861"),s("f0e2")),o=s("6922"),r=s.n(o);s("fda20"),s("7f10"),s("5898");const l=s("3e8f"),c=s("df7c");function d(t){if(console.log(t.path||t),!l.existsSync(t.path||t))return[];const e=c.dirname(t.path),s=c.extname(t.path),a=t.name.substring(0,t.name.lastIndexOf("."));console.log(e,a,s);const i=p(e,a),n=u(e,i),o=m(e,a),r=h(e,o);return[...n,...r]}function h(t,e){const s=[];try{e.forEach(((e,a,i)=>{i[a]=t+"/"+e;const n=l.readFileSync(i[a],"utf-8"),o=1===(e.match(/\./g)||[]).length?e:c.extname(e.substring(0,e.lastIndexOf("."))).substring(1)+".srt";s.push({src:URL.createObjectURL(new Blob([f(n)])),label:o,path:t+"\\"+e})}))}catch(a){console.log(a)}return console.log(s),s}function u(t,e){const s=[];try{e.forEach(((e,a,i)=>{i[a]=t+"/"+e;const n=l.readFileSync(i[a],"utf-8"),o=1===(e.match(/\./g)||[]).length?e:c.extname(e.substring(0,e.lastIndexOf("."))).substring(1)+".vtt";s.push({src:URL.createObjectURL(new Blob([n])),label:o,path:t+"\\"+e})}))}catch(a){console.log(a)}return console.log(s),s}function p(t,e){let s;try{s=l.readdirSync(t),s=s.filter((t=>t.startsWith(e)&&t.endsWith(".vtt")))}catch(a){console.log(a)}return s}function m(t,e){let s;try{s=l.readdirSync(t),s=s.filter((t=>t.startsWith(e)&&t.endsWith(".srt")))}catch(a){console.log(a)}return s}function f(t){var e=t.replace(/\r+/g,"");e=e.replace(/^\s+|\s+$/g,"");var s=e.split("\n\n"),a="";if(s.length>0){a+="WEBVTT\n\n";for(var i=0;i<s.length;i+=1)a+=g(s[i])}return a}function g(t){var e="",s=t.split(/\n/);while(s.length>3){for(var a=3;a<s.length;a++)s[2]+="\n"+s[a];s.splice(3,s.length-3)}var i=0;if(!s[0].match(/\d+:\d+:\d+/)&&s[1].match(/\d+:\d+:\d+/)&&(e+=s[0].match(/\w+/)+"\n",i+=1),!s[i].match(/\d+:\d+:\d+/))return"";var n=s[1].match(/(\d+):(\d+):(\d+)(?:,(\d+))?\s*--?>\s*(\d+):(\d+):(\d+)(?:,(\d+))?/);return n?(e+=n[1]+":"+n[2]+":"+n[3]+"."+n[4]+" --\x3e "+n[5]+":"+n[6]+":"+n[7]+"."+n[8]+"\n",i+=1,s[i]&&(e+=s[i]+"\n\n"),e):""}const v=s("ed08").isElectron();function b(t){if(!v||"string"!==typeof t)return t;const e=s("df7c"),a=e.basename(t);return{name:a,path:t}}var y=s("307e"),_=s("4d5f"),w=s("0613"),C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],attrs:{id:"video-splash"}},[s("div",{staticClass:"loading"},[s("q-circular-progress",{staticClass:"q-ma-md",attrs:{indeterminate:"",size:"24px",color:"primary"}}),s("p",[t._v(t._s(t.videoLoadingHint))])],1)])])},$=[],k={name:"VideoSplash",props:{show:{type:Boolean},videoLoadingHint:{type:String}},data(){return{}},created(){},mounted(){},computed:{},methods:{}},q=k,x=(s("426d"),s("2877")),S=s("58ea"),P=s("eebe"),T=s.n(P),I=Object(x["a"])(q,C,$,!1,null,"077eff30",null),O=I.exports;T()(I,"components",{QCircularProgress:S["a"]});var U=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"audio-info-container"},[s("p",{staticClass:"info"},[t._v(t._s(t.$t("this_is_an_audio_file")))]),s("img",{attrs:{src:t.icon,alt:"favicon",width:"100px"}})])])},j=[],A={name:"AudioInfo",components:{},props:{show:{type:Boolean}},data(){return{icon:s("a4a1")}},created(){},mounted(){},computed:{},methods:{}},B=A,L=(s("1ec7"),Object(x["a"])(B,U,j,!1,null,"0f7f3d28",null)),R=L.exports,D=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-dialog",{attrs:{value:t.show},on:{input:t.close}},[s("q-card",{staticStyle:{width:"600px","max-width":"80vw","overflow-x":"hidden"}},[s("q-card-section",{staticClass:"row"},[s("div",{staticClass:"text-h6 col-12"},[t._v(t._s(t.$t("advanced_options")))])]),s("q-card-section",{staticClass:"row"},[s("div",{staticClass:"col-4 justify-start q-pl-xl q-my-md"},[t._v(t._s(t.advancedOptions[0].name)+":")]),s("div",{staticClass:"col-8 justify-start q-pl-md q-my-md",staticStyle:{"word-wrap":"break-word"}},[t._v(t._s(t.advancedOptions[0].value))]),s("div",{staticClass:"col-4 justify-start q-pl-xl q-my-md"},[t._v(t._s(t.advancedOptions[1].name)+":")]),s("div",{staticClass:"col-8 justify-start q-pl-md q-my-md",staticStyle:{"word-wrap":"break-word"}},[t._v(t._s(t.advancedOptions[1].value))]),s("div",{staticClass:"col-4 justify-start q-pl-xl q-my-md"},[t._v(t._s(t.advancedOptions[2].name)+":")]),s("div",{staticClass:"col-8 justify-start q-pl-md q-my-md",staticStyle:{"word-wrap":"break-word"}},t._l(t.advancedOptions[2].value,(function(e,a){return s("div",{key:a,staticClass:"license-section"},[t._v("\n          "+t._s(e.label)+"\n        ")])})),0)])],1)],1)},Q=[],F={name:"AdvancedOptions",components:{},props:{show:Boolean,advancedOptions:Array},data(){return{}},created(){},mounted(){},computed:{},methods:{close(){this.$emit("close")}}},E=F,V=s("24e8"),z=s("f09f"),N=s("a370"),H=Object(x["a"])(E,D,Q,!1,null,"5c3e2e5d",null),M=H.exports;T()(H,"components",{QDialog:V["a"],QCard:z["a"],QCardSection:N["a"]});const W=s("ed08").isElectron();let G=null;W&&(G=s("bdb9").ipcRenderer),window.videojs=n["default"],s("d80d"),s("01a0"),s("8d5e");const K={toggleSplash(){},updatePlayer(){}};var Y={name:"Player",inject:["rootApp","io"],components:{VideoSplash:O,AudioInfo:R,AdvancedOptions:M},data(){return{player:null,playerOptions:{plugins:{hotkeys:r.a},fill:!1,autoplay:!0,responsive:!0,fluid:!0,preload:"auto",controls:!0,controlBar:{volumePanel:{inline:!1}}},subsBtn:null,progress:[],fileName:"",playerLang:"",playerCacheTime:0,subtitleList:[],showSplash:!1,videoLoadingHint:"",showAdvancedOptions:!1,isAudio:!1,isPause:!1}},created(){this.initVideoComponent(),this.playerLang=w["a"].state.setting.language,this.playerCacheTime=w["a"].state.setting.videoCacheTime,window.addEventListener("error",(t=>{console.log("Uncaught global error",t.message,"\nThis has no effect to app and can be ignore")})),W&&("Alphabiz"===this.settings.defaultVideoPlayer&&G.send("request-ask-for-player"),G.once("ask-for-player",(()=>{this.$q.notify({message:this.$t("not_default_player"),actions:[{label:this.$t("dont_show_again"),handler:()=>{w["a"].dispatch("set",{dontAskForPlayer:!0})}},{label:this.$t("go_to_settings"),handler:()=>{this.$router.push("/basicSetting")}}]}),w["a"].dispatch("set",{dontAskForPlayer:!0})})),this.$root.$on("pause-player-before-close",(()=>{this.player&&(this.isPause=!0,w["a"].state.video.currentVideo.pipStatus&&this.player&&this.player.exitPictureInPicture(),w["a"].state.video.currentVideo.status&&this.player&&this.player.pause())})));for(const t in K)"function"===typeof this[t]&&(K[t]=(...e)=>this[t](...e))},mounted(){this.loadPlayer(!0)},async activated(){if(this.playerLang!==w["a"].state.setting.language&&(this.playerLang=w["a"].state.setting.language,this.languageChange()),this.playerCacheTime!==w["a"].state.setting.videoCacheTime){console.log("videoCacheTime change",w["a"].state.setting.videoCacheTime),this.playerCacheTime=w["a"].state.setting.videoCacheTime;const t=this.updateCacheRate(w["a"].state.setting.videoCacheTime);if(t){this.updateSrc(w["a"].state.video.currentVideo.url,{clearSubtitle:!1,clearProgress:!1}),this.player.currentTime(w["a"].state.video.currentVideo.currentTime);const t=w["a"].state.video.currentVideo.currentTime/this.player.duration(),e=document.querySelector(".vjs-play-progress");e&&setTimeout((()=>{e.style.width=100*t+"%"}),500)}}W?(w["a"].state.video.currentVideo.remotePlay&&(this.loadPlayer(!0),this.toggleSplash(!0),this.player.bigPlayButton.hide(),G.send("get-stream-address"),G.once("stream-address",((t,e)=>{console.log("got stream address",e),this.toggleSplash(!1);let{address:s,filepath:a}=e;console.log("Stream play, try update player.src",e,"address",s,"filepath",a),a||(a=decodeURI(s).replace("play:///","").replace(/\//g,"\\")),w["a"].dispatch("currentVideoUrl",s),w["a"].dispatch("currentVideoPath",a),w["a"].dispatch("currentVideoCurrentTime",0);try{this.updateSrc(s),this.isPause?(setTimeout((()=>{this.player.pause()}),1e3),this.isPause=!1):this.player.play(),this.player.readyState()&&w["a"].dispatch("resetRemotePlay"),this.clearOldSubtitle(),this.addSubtitle(a)}catch(t){console.log("src err",t),w["a"].dispatch("resetRemotePlay")}}))),w["a"].state.video.currentVideo.url||w["a"].state.video.currentVideo.infoHash||this.loadPlayer(!0)):w["a"].state.video.currentVideo.url!==this.player.src()&&console.log("url changed",w["a"].state.video.currentVideo.url,this.player.src()),this.io.on("server_progress",(t=>{var e;if("/player"!==this.$router.currentRoute.path)return;if(!this.player&&!this.player.readyState())return;if(null===(e=w["a"].state.video.currentVideo)||void 0===e||!e.url)return;const s=t.find((t=>{var e;return null===(e=w["a"].state.video.currentVideo)||void 0===e?void 0:e.url.includes(t.name)}));if(s&&s.progress){const t=[],e=s.progress.length;let a=s.progress[0],i=1;for(let n=1;n<e;n++)if(s.progress[n]===a&&n<e-1)i+=1;else{if(s.progress[n+1]===a){i+=1;continue}n===e-1&&(i+=1),i&&t.push({color:1===a?"gold":"transparent",length:i/e*100}),a=s.progress[n],i=1}this.updateProgress(t)}})),this.io.on("clear_player",(t=>{if(w["a"].state.video.currentVideo.infoHash!==t.infoHash)return;const e=/^http/gm.test(w["a"].state.video.currentVideo.url),s=/^play:\/\//gm.test(w["a"].state.video.currentVideo.url);s&&"paused"===t.status||(e||s)&&(w["a"].state.video.currentVideo.pipStatus&&this.player.exitPictureInPicture(),w["a"].dispatch("resetPlayer"),this.$destroy(),setTimeout((()=>{this.$router.push("/player"),e&&this.$q.notify(this.$t("stop_stream_player")),s&&this.$q.notify(this.$t("stop_player"))}),500))}))},beforeDestroy(){this&&this.player&&this.player.dispose()},computed:{lang(){const t=w["a"].state.setting.language?w["a"].state.setting.language:"en-US";return this.player&&this.player.language(t),t},settings(){const t=w["a"].state.setting;return{defaultVideoPlayer:t.defaultVideoPlayer}},advancedOpt(){let t=w["a"].state.video.currentVideo.path;const e=w["a"].state.video.currentVideo.url;e&&e.startsWith("play://")&&(t=decodeURI(e).replace("play:///","").replace(/\//g,"\\"));const s=t?t.match(/(?:.(?!\\))+$/):this.fileName;return[{name:this.$t("title"),value:decodeURIComponent(s).replace("\\","")},{name:this.$t("location"),value:t},{name:this.$t("subtitle_file"),value:this.subtitleList}]}},watch:{"$store.state.video.currentVideo.updatePlayer"(t,e){console.log("watch updatePlayer:",t),t&&t!==e&&(console.log("need update player"),w["a"].dispatch("updatePlayer",!1),this.updatePlayer(w["a"].state.video.currentVideo.url))}},methods:{toggleSplash(t,e=""){this.showSplash=t,this.videoLoadingHint=e},toggleAudio(t){this.isAudio=t},toggleAdvancedOptions(t){this.showAdvancedOptions=t},openFile(){this.$refs.file.click()},bigPlayBtnOpenFile(){const t=document.querySelector("#my-video video").src;t?this.player.play():this.openFile()},async languageChange(){this.player&&(this.player.language(this.lang),this.updateComponentText(),w["a"].state.video.currentVideo.url&&await this.loadPlayer(!0))},manualAddFile(t){console.log("Open Media File: "+t.target.files[0].name),0!==t.target.files.length&&(t.target.files[0].path&&w["a"].dispatch("currentVideoPath",t.target.files[0].path),this.updatePlayer(t.target.files[0]),setTimeout((()=>{this.$refs.file.value=null}),500))},async manualAddSubtitle(t){const e=t.target.files;if(!e.length)return;const s=e[0];console.log("manualAddSubtitle",s,s.name);const a=this.player.textTracks();await this.addSubtitle(s,s.name);let i=-1;setTimeout((()=>{for(let t=0;t<a.length;t++)s.name.includes(a[t].label)&&(i=t),a[t].mode="disabled";-1!==i&&(a[i].mode="showing"),this.appendAddSubBtn(),t.target.value=""}),500)},initVideoComponent(){const t=n["default"].getComponent("Button"),e=n["default"].getComponent("MenuItem");n["default"].registerComponent("FileButton",n["default"].extend(t,{constructor:function(){t.apply(this,arguments);const e=arguments[1];this._text=e.text||"Open File...",this.el_.innerHTML=`<span class="open" title="${this._text}"></span>`,this.updateTitle=function(t){this.el_.innerHTML=`<span class="open" title="${t}"></span>`}}})),n["default"].registerComponent("SubsButton",n["default"].extend(t,{constructor:function(){t.apply(this,arguments);const e=arguments[1];this._text=e.text||"Add subtitles...",this.el_.innerHTML=`<span class="subs" title="${this._text}"></span>`,this.updateTitle=function(t){this.el_.innerHTML=`<span class="subs" title="${t}"></span>`}}})),n["default"].registerComponent("AddSubButton",n["default"].extend(e,{constructor:function(){e.apply(this,arguments);const t=arguments[1];this._text=t.text||"Add subtitles...",this.el_.innerHTML+=`<span>${this._text}</span>`}})),n["default"].registerComponent("AdvancedOptionsButton",n["default"].extend(t,{constructor:function(){t.apply(this,arguments);const e=arguments[1];this._text=e.text||"Advanced Options",this.el_.innerHTML=`<span class="advanced" title="${this._text}"></span>`,this.updateTitle=function(t){this.el_.innerHTML=`<span class="advanced" title="${t}"></span>`}}}));const s=n["default"].getComponent("SeekBar");s.prototype.getPercent=function(){const t=this.player_.currentTime(),e=t/this.player_.duration();return e>=1?1:e},s.prototype.handleMouseMove=function(t){let e=this.calculateDistance(t)*this.player_.duration();e===this.player_.duration()&&(e-=.1),this.player_.currentTime(e),this.update()}},addControlBarComponent(){const t=this.player.controlBar.addChild("FileButton",{text:this.$t("open_file")},1);t.on("click",this.openFile),this.subsBtn=this.player.controlBar.addChild("SubsButton",{text:this.$t("add_subtitles")},14),this.subsBtn.on("click",(()=>this.$refs.subtitle.click()));const e=this.player.controlBar.addChild("AdvancedOptionsButton",{text:this.$t("advanced_options")},16);e.on("click",(()=>{this.player.isFullscreen()&&this.player.exitFullscreen(),this.toggleAdvancedOptions(!0)}))},updateComponentText(){const t=this.player.controlBar.getChild("FileButton");t.updateTitle(this.$t("open_file")),this.subsBtn.updateTitle(this.$t("add_subtitles"));const e=this.player.controlBar.getChild("AdvancedOptionsButton");e.updateTitle(this.$t("advanced_options"))},loadPlayer(t=!1){let e=()=>{};const s=new Promise((t=>{e=t}));if(!n["default"].getPlayer("my-video")||t){if(t){Object(n["default"])("my-video")&&Object(n["default"])("my-video").dispose();const t=document.querySelector("#video-container");t&&(t.innerHTML='<video\n            crossorigin="anonymous"\n            id="my-video"\n            class="video-js vjs-default-skin vjs-16-9 vjs-big-play-centered vjs-fluid"\n            ref="video"\n            style="height:100%"\n          ></video>')}try{this.player=Object(n["default"])("my-video",this.playerOptions,(()=>e()))}catch(a){console.log("loadPlayer error",a);const t=a.message;t.includes("The element or ID supplied is not valid.")&&(w["a"].dispatch("resetPlayer"),this.$destroy())}if(this.player.on("ready",(async()=>{w["a"].dispatch("updateVideoStatus",!1)})),this.player.on("canplay",(()=>{w["a"].dispatch("resetRemotePlay");const t=(W?w["a"].state.video.currentVideo.path:this.fileName||w["a"].state.video.currentVideo.url).split(".").pop();if(this.toggleAudio(Object(y["b"])(t)),!w["a"].state.video.currentVideo.url){const t=document.querySelector("#my-video video").src;w["a"].dispatch("currentVideoUrl",t);const e=t.split("/"),s=e[e.length-1];"undefined"!==typeof s&&(this.fileName=s),this.loadPlayer(!0),setTimeout((()=>this.player.play()),500)}setTimeout((()=>{!1===w["a"].state.video.currentVideo.status&&this.player.paused()&&this.player.bigPlayButton.show()}),700)})),this.player.on("play",(async()=>{if("Alphabiz"!==this.settings.defaultVideoPlayer&&w["a"].state.video.currentVideo.url.startsWith("play://")&&w["a"].state.video.currentVideo.infoHash){this.player.pause(),this.player.exitPictureInPicture();const t=w["a"].state.video.currentVideo.path;return console.log("player will pause,open default player,"+t),await Object(_["b"])(this.settings.defaultVideoPlayer,t),w["a"].dispatch("resetPlayer"),this.loadPlayer(!0)}this.player.bigPlayButton.hide(),w["a"].dispatch("updateVideoStatus",!0)})),this.player.on("pause",(()=>{4===this.player.readyState()&&this.player.bigPlayButton.show(),w["a"].dispatch("updateVideoStatus",!1)})),this.player.on("seeked",(()=>{setTimeout((()=>{const t=document.querySelector(".vjs-load-progress"),e=document.querySelector(".vjs-play-progress");t.style.width=e.style.width}),200)})),this.player.on("waiting",(()=>{const t=document.querySelector("#my-video video");t&&(t.style.backgroundColor="black")})),this.player.on("loadedmetadata",(()=>{const t=w["a"].state.video.currentVideo.url;if(!t||!/^http/gm.test(t))return;if(!/wait=0$/gm.test(t)||0===w["a"].state.setting.videoCacheTime)return;const e=this.updateCacheRate(w["a"].state.setting.videoCacheTime);e&&(this.updateSrc(w["a"].state.video.currentVideo.url,{clearSubtitle:!1,clearProgress:!1}),this.player.currentTime(w["a"].state.video.currentVideo.currentTime))})),this.player.on("leavepictureinpicture",(()=>{w["a"].dispatch("updateVideoPIPStatus",!1),setTimeout((()=>{this.player.paused()||this.$router.push("/player")}),500)})),this.player.on("enterpictureinpicture",(()=>{w["a"].dispatch("updateVideoPIPStatus",!0),setTimeout((()=>this.player.play()),500)})),this.player.on("timeupdate",(()=>{w["a"].dispatch("currentVideoCurrentTime",this.player.currentTime())})),this.player.on("error",(()=>{if(this.toggleSplash(!1),/^http/gm.test(w["a"].state.video.currentVideo.url)&&w["a"].state.video.currentVideo.remotePlay)return;const t=this.player.languages()[this.player.language()],e=t&&t[this.player.error_.message]||this.player.error_.message;if(4!==this.player.error_.code||W)this.$q.notify(e);else{const t='<i class="q-icon material-icons q-ml-xs">open_in_new</i>',s=`${this.$t("download")} Alphabiz Desktop${t}`,a=`<a class='doc-link' href='https://alpha.biz' target='_blank'>${s}</a>`;this.$q.notify({html:!0,message:`<span>${e}</span>${a}`,closeBtn:this.$t("close"),timeout:0})}w["a"].dispatch("currentVideoUrl",null),w["a"].dispatch("currentVideoPath",null),this.$q.loading.hide(),this.loadPlayer(!0)})),w["a"].state.video.currentVideo.url&&!w["a"].state.video.currentVideo.remotePlay){const t=this.subtitleList,e=w["a"].state.video.currentVideo.status,s=w["a"].state.video.currentVideo.updatePlayer;if(this.updateSrc(w["a"].state.video.currentVideo.url),this.player.currentTime(s?0:w["a"].state.video.currentVideo.currentTime),console.log("loadplayer(force) status",e),!s&&!e&&!/^https:\/\/localhost:8080\/webtorrent/gm.test(w["a"].state.video.currentVideo.url)){const t=()=>{this.player.pause(),this.player.off("play",t)};this.player.on("play",t)}t.length?this.restoreSub(t):this.addSubtitle(w["a"].state.video.currentVideo.path),w["a"].dispatch("updatePlayer",!1)}return this.player.bigPlayButton.on("click",this.bigPlayBtnOpenFile),this.addControlBarComponent(),w["a"].dispatch("updateVideoPIPStatus",!1),s}this.player=n["default"].getPlayer("my-video")},async updatePlayer(t){if(!t)return;this.player||await this.loadPlayer();const e="string"===typeof t?t:URL.createObjectURL(t);console.log("update Player",t,e),this.fileName=t.name,w["a"].dispatch("currentVideoUrl",e),this.updateSrc(e),w["a"].dispatch("resetInfoHash"),this.clearOldSubtitle(),w["a"].state.video.currentVideo.path?await this.addSubtitle(w["a"].state.video.currentVideo.path):await this.addSubtitle(t,t.name)},updateSrc(t,e={clearSubtitle:!0,clearProgress:!0}){this.toggleAudio(!1),e.clearProgress&&this.clearProgress(),e.clearSubtitle&&(this.subtitleList=[]),t.startsWith("play://")&&(t+=`?infoHash=${w["a"].state.video.currentVideo.infoHash}`),console.log("updateSrc()",t),this.player.src([{src:t,type:"video/mp4"}])},updateCacheRate(t){if(!this.player.duration())return;const e=60*t/this.player.duration(),s=w["a"].state.video.currentVideo.url;return!!s&&(w["a"].dispatch("currentVideoUrl",s.replace(/wait=.*/gm,`wait=${e}`)),!0)},updateProgress(t){if(t){let e=document.querySelector("#download-progress");if(!e){const t=document.querySelector(".vjs-progress-holder");if(!t)return;e=t.appendChild(document.createElement("div")),e.id="download-progress"}const s=t=>{let e=0;for(let s=0;s<t.length;s++)e=0===s?t[s].length:s===t.length-1?0:t[s].length>1?e+t[s].length:e+1,t[s].rate=e;return t},a=s(t);e.style.background=a.reduce(((t,e)=>t+`, ${e.color} 0%, ${e.color} ${e.rate}%`),"linear-gradient(90deg")+")"}},clearProgress(){let t=document.querySelector("#download-progress");if(!t){const e=document.querySelector(".vjs-progress-holder");if(!e)return;t=e.appendChild(document.createElement("div")),t.id="download-progress"}t.style.background=""},async addSubtitle(t,e){var s;console.log("sub",t,e);let a=t;if("string"===typeof t){if(t.startsWith("blob:"))return;a=t.startsWith("play://")?b(decodeURI(t.replace("play:///",""))):b(t)}e||(e=(null===(s=a)||void 0===s?void 0:s.name)||"");const i=e.match(/\.[^.]+$/);if(!i)return;const n=i[0].toLowerCase();console.log("addSubtitle sub",a,e);let o=!1,r=!1;if(W)[".ass"].includes(n)?console.log("add .ass sub"):await Promise.all(d(a).map((t=>(o=!0,new Promise((s=>{setTimeout((()=>{r=this.isRepeatSubtitle(t.label),console.log("obj",t,r),r||(this.player.addRemoteTextTrack({kind:"captions",label:t.label||e,src:t.src},!0),this.updateSubtitleList(t.label||e,t.path)),s()}))}))))));else{if(console.log("web addSubtitle"),![".srt",".vtt"].includes(n))return;r=this.isRepeatSubtitle(e),r||await new Promise((t=>{const s=new FileReader;s.readAsText(a),s.onload=s=>{const a=".vtt"===n?s.target.result:f(s.target.result);this.player.addRemoteTextTrack({src:URL.createObjectURL(new Blob([a])),kind:"captions",label:e},!0),this.updateSubtitleList(e,""),o=!0,t()}}))}if(o&&this.subsBtn){this.subsBtn.addClass("hidden");const t=this.player.textTracks();t&&t[0]&&(t[0].mode="showing"),this.appendAddSubBtn()}},isRepeatSubtitle(t){const e=this.player.textTracks();let s=!1;for(let a=0;a<e.length;a++)t.includes(e[a].label)&&(s=!0);return s},updateSubtitleList(t,e){this.subtitleList.push({label:t,path:e})},clearOldSubtitle(){if(!this.subsBtn)return;this.subsBtn.removeClass("hidden");const t=this.player.remoteTextTracks();for(let e=t.length-1;e>=0;e--)this.player.removeRemoteTextTrack(t[e])},restoreSub(t){console.log("restoreSub"),this.subtitleList=[],t.forEach((async(t,e)=>{console.log(t,e),t.path&&await this.addSubtitle(t.path)}))},appendAddSubBtn(){const t=this;setTimeout((()=>{const e=this.player.controlBar.subsCapsButton,s=e.menu.children();if(!s)return;if(s.some((t=>"AddSubButton"===t.name_)))return;const a=e.menu.addChild("AddSubButton",{text:t.$t("add_subtitles")},2);a.addClass("add-sub-btn"),a.on("click",(()=>{this.$refs.subtitle.click()}))}),1e3)}}},J=Y,Z=(s("941d"),s("9989")),X=s("0016"),tt=Object(x["a"])(J,a,i,!1,null,null,null);e["default"]=tt.exports;T()(tt,"components",{QPage:Z["a"],QIcon:X["a"]})},9384:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.dense?"col-4":"col-12"},[s("q-checkbox",{staticClass:"q-mt-sm",attrs:{value:t.value,label:t.label,dense:""},on:{input:t.onChange}},[t.tooltip?s("q-tooltip",[t._v(t._s(t.tooltip))]):t._e()],1)],1)},i=[],n={props:{value:{required:!0},label:String,keyName:String,dense:Boolean,tooltip:{type:String,required:!1}},methods:{onChange(t){this.$emit("change",this.keyName,t)}}},o=n,r=s("2877"),l=s("8f8e"),c=s("05c0"),d=s("eebe"),h=s.n(d),u=Object(r["a"])(o,a,i,!1,null,null,null);e["a"]=u.exports;h()(u,"components",{QCheckbox:l["a"],QTooltip:c["a"]})},"941d":function(t,e,s){"use strict";s("52af")},"959b":function(t,e,s){"use strict";s("3373")},"9c81":function(t,e,s){},"9e90":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-dialog",{attrs:{value:t.showPanel},on:{input:t.close}},[s("q-card",[s("q-card-section",{staticClass:"row items-center"},[s("q-expansion-item",{staticStyle:{width:"400px"},attrs:{"expand-separator":"","default-opened":"",icon:"people",label:"Peers ("+t.abPeers.length+")",caption:"Alphabiz peer"}},[s("div",{staticClass:"total col-12 q-px-md q-ml-sm"},[s("span",[t._v(t._s(t.$t("credit_cost"))+": "+t._s(t.torrentExpensesNum))])]),t._l(t.abPeers,(function(e){return s("q-field",{key:e.id,attrs:{label:e.subId||e.id,"stack-label":"",borderless:"",readonly:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[s("div",{staticClass:"q-px-sm"})]},proxy:!0},{key:"control",fn:function(){return[t._l(e.addresses,(function(e,a){return s("div",{key:a+"-"+e,staticClass:"self-center full-width not-outline"},[t._v(" - "+t._s(e)+"\n            ")])})),s("div",{staticClass:"text full-width q-mt-xs"},[s("span",{staticClass:"peer-speed q-ml-xs q-mr-lg",class:{"text-primary":"0.00 KB"!==e.uploadSpeed}},[t._v("↑ "+t._s(e.uploadSpeed)+" / s")]),e.isPayed?s("q-icon",{staticClass:"text-primary q-mx-xs cursor-pointer",attrs:{name:"bolt"}},[s("q-tooltip",[t._v(" "+t._s(t.$t("accelerating")))])],1):t._e(),s("span",{staticClass:"peer-speed q-mr-md",class:{"text-primary":"0.00 KB"!==e.downloadSpeed}},[t._v("↓ "+t._s(e.downloadSpeed)+" / s")]),s("span",{directives:[{name:"show",rawName:"v-show",value:e.downloaded,expression:"peer.downloaded"}],staticClass:"peer-downloaded text-primary"},[t._v(t._s(e.downloadedData))])],1)]},proxy:!0}],null,!0)})}))],2)],1),s("q-card-section",{staticClass:"q-py-none"},[s("div",{staticClass:"total text-center"},[t._v("\n        "+t._s(t.$t("pay_with_credit_payed",[t.totalCredits]))+"\n      ")])]),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.$t("cancel")}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.$t("ok")}})],1)],1)],1)},i=[],n=(s("ddb0"),s("f880")),o=s("0613"),r=s("c0c0"),l={props:{show:{type:Boolean,required:!0},torrent:{type:Object,required:!0},paymentSize:{type:Number,default:1e7}},mixins:[r["a"]],computed:{torrentExpensesNum(){const t=this.dp$expenseTxnList;return t?Number((t.reduce(((t,e)=>{if(e.meta){let a;try{a=JSON.parse(e.meta)}catch(s){a=e.meta}if(a&&"object"===typeof a&&a.infoHash===this.torrent.infoHash)return t+e.amount}return t}),0)/1e3).toFixed(3)):0},showPanel(){return this.show},totalCredits(){const t=this.torrent.length,e=t-this.torrent.downloaded,s=Number((e/1e10).toFixed(3));return s},abPeers(){if(!this.torrent||!this.torrent.connections)return[];const t=this.torrent.connections.filter((t=>t.isAbPeer&&t.hasResource&&t.subId!==o["a"].getters.accountUserInfo.sub)),e={};for(const s of t){const t=s.subId;t&&(e[t]?(e[t].isAbPeer|=s.isAbPeer,e[t].addresses.push(s.address),e[t].uploadSpeed+=s.uploadSpeed,e[t].downloadSpeed+=s.downloadSpeed,e[t].downloaded+=s.downloaded):(e[t]={...s},e[t].addresses=[s.address]))}return Object.values(e).sort(((t,e)=>t.id.localeCompare?t.id.localeCompare(e.id):0)).map((t=>(t.uploadSpeed=Object(n["a"])(t.uploadSpeed,{byte:!1,gb:!1}),t.downloadSpeed=Object(n["a"])(t.downloadSpeed,{byte:!1,gb:!1}),t.downloadedData=Object(n["a"])(t.downloaded,{byte:!0,gb:!0}),t.isPayed="high"===t.remoteGroup,t)))},payedConnections(){return this.abPeers.filter((t=>t.isPayed))},downloadedFromPayed(){return Object(n["a"])(this.payedConnections.reduce(((t,e)=>t+e.downloaded||0),0),{byte:!0,gb:!0})},hasPayed(){return this.payedConnections.length}},methods:{confirmPayment(){if(!this.abPeers.length)return;let t=10;const e=Math.floor(10*this.torrent.downloadSpeed/this.paymentSize);e>t&&(t=e);const s=this.torrent.length-this.torrent.downloaded;s<t*this.paymentSize/this.abPeers.length&&(t=Math.ceil(s/this.paymentSize/this.abPeers.length));const a=o["a"].getters.accountUserInfo;if(!a||!a.sub)return this.$q.notify("Please login first");this.$emit("setAutoRenew",this.torrent.infoHash,!0),this.abPeers.forEach((e=>{console.log("pay for",e),e.isPayed?console.log("skip high level peer",e):(console.log("dp$ create payment from","AlphabizPanel::confirmPayment"),this.$emit("createPayment",{infoHash:this.torrent.infoHash,remoteSubId:e.subId,payed:t,autoRenew:!0},!0))})),this.close()},close(){this.$emit("close")}}},c=l,d=s("2877"),h=s("24e8"),u=s("f09f"),p=s("a370"),m=s("3b73"),f=s("8572"),g=s("0016"),v=s("05c0"),b=s("4b7e"),y=s("9c40"),_=s("7f67"),w=s("eebe"),C=s.n(w),$=Object(d["a"])(c,a,i,!1,null,null,null);e["a"]=$.exports;C()($,"components",{QDialog:h["a"],QCard:u["a"],QCardSection:p["a"],QExpansionItem:m["a"],QField:f["a"],QIcon:g["a"],QTooltip:v["a"],QCardActions:b["a"],QBtn:y["a"]}),C()($,"directives",{ClosePopup:_["a"]})},a76d:function(t,e,s){"use strict";var a;s.d(e,"a",(function(){return a})),function(t){t["system"]="system",t["light"]="light",t["dark"]="dark"}(a||(a={}))},a939:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"relative-position follow-btn btn",class:{hovered:t.hovered,followable:t.followable,pending:t.pending,disableFollow:t.disableFollow},on:{mouseover:function(e){t.hovered=!0},mouseleave:function(e){t.hovered=!1},click:t.onClick}},[t.pending?s("q-spinner-dots",{attrs:{size:"18px",thickness:5}}):s("span",{staticClass:"follow-btn-label"},[t._v(t._s(t.followBtnLabel))])],1)},i=[],n=s("0613"),o=s("4aad"),r={name:"LibraryFollowButton",props:{id:String,disableFollow:Boolean},data(){return{hovered:!1}},computed:{pending(){return n["a"].getters.followQueue.includes(this.id)},followable(){return!o["a"].followingChannels.find((t=>t.id===this.id))},followBtnLabel(){return this.followable?this.$t("follow"):this.hovered?this.$t("unfollow"):this.$t("following")}},methods:{async onClick(){if(this.pending)return;if(this.disableFollow)return this.$q.notify("Please wait for loaded");const t=this.id;if(!t)return;if(!o["a"].channelList.some((e=>e.id===t)))return this.$q.dialog({title:this.$t("cannot_find_channel"),message:this.$t("cannot_get_channel_info"),ok:this.$t("ok")});const e=!!this.followable;if(!e){const t=await new Promise((t=>{this.$q.dialog({title:this.$t("unfollow"),message:this.$t("unfollow_confirm"),ok:this.$t("unfollow"),cancel:this.$t("cancel")}).onOk((()=>t(!1))).onCancel((()=>t(!0)))}));if(t)return}n["a"].commit("addFollowQueue",t),(e=>{let s=0,a=0,i=0;const r=()=>{clearInterval(a),clearTimeout(s),i&&i(),n["a"].commit("removeFollowQueue",t)};a=setInterval((()=>{this.followable===e?(console.log("Failed to toggle follow",t,e,this.followable),e?o["a"].followChannel(t):o["a"].unfollowChannel(t)):r()}),1e3),i=this.$watch("followable",(t=>{t!==e&&r()})),s=setTimeout((()=>{this.followable===e&&this.$q.notify(this.$t("follow_failed_hint"))}),1e4)})(e),e?o["a"].followChannel(t):o["a"].unfollowChannel(t)}}},l=r,c=(s("bad3"),s("2877")),d=s("8380"),h=s("b498"),u=s("714f"),p=s("eebe"),m=s.n(p),f=Object(c["a"])(l,a,i,!1,null,"44007b02",null);e["a"]=f.exports;m()(f,"components",{QSpinnerDots:d["a"],QColor:h["a"]}),m()(f,"directives",{Ripple:u["a"]})},af2c:function(t,e,s){"use strict";s("db60")},b2bc:function(t,e,s){},b35b:function(t,e,s){"use strict";s("b68e")},b4ab:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-dialog",{attrs:{value:t.show,persistent:""},on:{input:t.changeShow}},[s("input",{ref:"fileSelector",staticStyle:{display:"none"},attrs:{type:"file",id:"file-selector"},on:{change:t.onFileChange}}),s("input",{ref:"folderSelector",staticStyle:{display:"none"},attrs:{type:"file",webkitdirectory:"",id:"folder-selector"},on:{change:t.onFolderChange}}),s("q-card",{staticClass:"card-container"},[s("q-card-section",{staticClass:"card-header non-selectable"},[s("div",{staticClass:"text-h5 text-weight-bold q-my-none"},[t._v(t._s(t.$t("quick_start")))])]),s("div",{staticClass:"card-content"},[s("q-card-section",{staticClass:"q-pt-none"},[s("div",{staticClass:"from-file-or-task flex items-start justify-start q-mb-lg"},[s("div",{staticClass:"from-file-or-folder q-mr-sm"},[s("q-btn",{staticClass:"full-width",class:{"q-mt-sm":!t.isElectron},attrs:{unelevated:"",dense:t.isElectron,color:"primary",label:t.$t("select_file")},on:{click:function(){return t.$refs.fileSelector.click()}}}),t.isElectron?s("q-btn",{staticClass:"full-width q-mt-sm",attrs:{unelevated:"",dense:"",color:"primary",label:t.$t("select_folder")},on:{click:function(){return t.$refs.folderSelector.click()}}}):t._e()],1),s("q-select",{staticClass:"col-grow",attrs:{outlined:"",dense:"","bottom-slots":"","use-input":"","menu-anchor":"bottom right","menu-self":"top end","menu-offset":[0,0],"popup-content-style":"height: 320px !important",behavior:"menu",label:t.$t("select_from_tasks"),options:t.taskOptions},on:{input:t.selectTask,filter:t.filterOptions},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"hint",fn:function(){return[s("div",{staticClass:"from-magnet text-primary cursor-pointer non-selectable",on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.showMagnetInput=!0}}},[t._v("\n                "+t._s(t.$t("import_from_magnet"))+"\n              ")])]},proxy:!0}]),model:{value:t.abSelect,callback:function(e){t.abSelect=e},expression:"abSelect"}})],1),s("div",{staticClass:"post-inputs"},[s("q-input",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",label:t.$t("post_title"),rules:[t.rules.validatePostTitle]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.postTitle,callback:function(e){t.postTitle=e},expression:"postTitle"}}),s("q-input",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",label:t.$t("placeholder_post_desc"),rules:[t.rules.validatePostDesc]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.postDescription,callback:function(e){t.postDescription=e},expression:"postDescription"}}),s("q-input",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",label:"Alphabiz URL",rules:[t.rules.validatePostUrl]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.abUrl,callback:function(e){t.abUrl=e},expression:"abUrl"}}),s("ImageWithPreview",{staticClass:"q-mb-sm",attrs:{label:t.$t("poster"),rules:[t.rules.validatePostImage]},on:{state:t.updatePostImageState},model:{value:t.postImage,callback:function(e){t.postImage=e},expression:"postImage"}}),s("q-select",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",options:t.rateOptions,label:t.$t("film_rate")},model:{value:t.rate,callback:function(e){t.rate=e},expression:"rate"}})],1)]),s("q-card-section",{staticClass:"q-py-none"},[s("div",{staticClass:"channel-option non-selectable"},[s("label",{staticClass:"text-bold q-mr-sm",staticStyle:{"font-size":"1.125rem"}},[t._v(t._s(t.$t("channel_options")))]),s("q-radio",{attrs:{val:!0,label:t.$t("create_new_channel")},model:{value:t.createChannel,callback:function(e){t.createChannel=e},expression:"createChannel"}}),s("q-radio",{attrs:{val:!1,label:t.$t("use_existed_channel")},model:{value:t.createChannel,callback:function(e){t.createChannel=e},expression:"createChannel"}})],1),t.createChannel?s("div",{staticClass:"channel-inputs"},[s("q-input",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",label:t.$t("channel_title"),rules:[t.rules.validateChannelTitle]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.channelTitle,callback:function(e){t.channelTitle=e},expression:"channelTitle"}}),s("q-input",{staticClass:"full-width q-mb-sm",attrs:{dense:"",outlined:"",label:t.$t("placeholder_channel_desc"),rules:[t.rules.validateChannelDesc]},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.channelDescription,callback:function(e){t.channelDescription=e},expression:"channelDescription"}}),s("ImageWithPreview",{attrs:{label:t.$t("channel_poster"),rules:[t.rules.validateChannelImage]},on:{state:t.updateChannelImageState},model:{value:t.channelImage,callback:function(e){t.channelImage=e},expression:"channelImage"}})],1):s("div",{staticClass:"channel-select"},[s("q-select",{staticClass:"full-width",attrs:{outlined:"","bottom-slots":"","use-input":"",dense:"","popup-content-style":"max-height: 320px !important","menu-anchor":"bottom right","menu-self":"top end","menu-offset":[0,0],"data-cy":"select-direct",behavior:"menu",label:t.$t("select_existed_channel"),options:t.channelOptions},on:{filter:t.filterChannels},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"option",fn:function(e){return[s("q-item",t._g(t._b({},"q-item",e.itemProps,!1),e.itemEvents),[s("q-item-section",[s("q-item-label",[s("span",{staticClass:"label"},[t._v(t._s(e.opt.label))]),s("small",{staticClass:"text-grey q-ml-sm"},[t._v(t._s(e.opt.caption))])])],1)],1)]}}]),model:{value:t.selectedChannel,callback:function(e){t.selectedChannel=e},expression:"selectedChannel"}})],1)])],1),s("q-card-actions",{staticClass:"card-footer",attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:t.$t("cancel")}}),s("q-btn",{attrs:{unelevated:"",label:t.$t("lib_submit"),disable:!t.submitReady,"text-color":"primary",color:"primary"},on:{click:t.submit}})],1)],1),s("q-dialog",{attrs:{value:!!t.progressText,persistent:""}},[s("q-card",{staticClass:"progress-card"},[s("q-card-section",[s("div",{staticClass:"text q-pa-md"},[t._v(t._s(t.progressText))])])],1)],1),s("q-dialog",{on:{hide:function(e){t.magnetInput=""}},model:{value:t.showMagnetInput,callback:function(e){t.showMagnetInput=e},expression:"showMagnetInput"}},[s("q-card",{staticStyle:{width:"480px"}},[s("q-card-section",{staticClass:"full-width"},[s("div",{staticClass:"text-h6"},[t._v(t._s(t.$t("input_magnet_url")))]),s("q-input",{attrs:{type:"text",placeholder:"magnet:?...",autofocus:""},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.magnetInput,callback:function(e){t.magnetInput=e},expression:"magnetInput"}})],1),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",icon:"close",color:"primary"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",icon:"done"},on:{click:t.fromMagnet}})],1)],1)],1)],1)},i=[],n=(s("ace4"),s("5cc6"),s("907a"),s("3c5d"),s("219c"),s("ddb0"),s("498a"),s("f880")),o=s("4aad"),r=s("648d"),l=s("c65d"),c=s("ed08"),d=s("df7c");function h(t){if(!Array.isArray(t)||!t[0])return"";let e=Object(d["dirname"])(t[0]);for(let s=1;s<t.length;s++)while(!t[s].includes(e)&&e.length>1)e=Object(d["dirname"])(e);return e}var u=s("1141"),p=s("c428"),m=s("8847"),f=s("20fc"),g=s("849b"),v=s("0613");const b=4e9,y=t=>new Promise((e=>setTimeout(e,t))),_=()=>{const t=new Uint8Array(12);return crypto.getRandomValues(t),t.reduce(((t,e)=>{const s=e.toString(16).padStart(2,"0");return t+s}),"")};var w={components:{ImageWithPreview:l["a"]},name:"QuickStart",props:{show:Boolean,preset:{required:!1,default:null}},data(){const t=[{label:this.$t("rate_g"),value:"G"},{label:this.$t("rate_pg"),value:"PG"},{label:this.$t("rate_pg_13"),value:"PG-13"},{label:this.$t("rate_r"),value:"R"},{label:this.$t("rate_nc_17"),value:"NC-17"}],e={validateChannelTitle(t){return t.length>0&&t.length<100||m["b"].t("validate_channel_title_length")},validateChannelDesc(t){return t.length>9&&t.length<301||m["b"].t("validate_channel_desc_length")},validateChannelImage(t){return!t||(t.match(/\s/)?m["b"].t("validate_url_no_space"):(t.startsWith("http://")||t.startsWith("https://"))&&t.length<2048||m["b"].t("validate_channel_image_url"))},validatePostTitle(t){return t.length>0&&t.length<100||m["b"].t("validate_post_title_length")},validatePostDesc(t){return t.length>9&&t.length<301||m["b"].t("validate_post_desc_length")},validatePostImage(t){return!t||(t.match(/\s/)?m["b"].t("validate_url_no_space"):(t.startsWith("http://")||t.startsWith("https"))&&t.length<2048||m["b"].t("validate_post_image_url"))},validatePostUrl(t){if(!t.startsWith("ab://")&&!t.startsWith("alphabiz://"))return m["b"].t("validate_post_url");const e=Object(p["a"])(t);return 28!==e.length?m["b"].t("validate_post_url"):t.length<2048||m["b"].t("validate_post_url_length")}};return{rules:e,progressText:"",postTitle:"",titleFromTask:"",postDescription:"",postImage:"",isPostImageLoaded:!1,channelTitle:"",channelDescription:"",channelImage:"",isChannelImageLoaded:!1,abUrl:"",abSelect:null,rateOptions:t,magnetInput:"",showMagnetInput:!1,createChannel:!0,rate:t[0],taskOptions:[],channelFilterInput:"",selectedChannel:{label:"",title:"",id:""},isElectron:Object(c["isElectron"])()}},computed:{username(){return o["a"].userData.name?o["a"].userData.name:v["a"].getters.accountUserInfo.nickname?v["a"].getters.accountUserInfo.nickname:o["a"].user.name||"-"},uploadingTasks(){return r["a"].taskList.uploading.map((t=>this.getTaskOption(t)))},channelOptions(){return o["a"].ownedChannels.filter((t=>!!t.id&&t.title.toLowerCase().includes(this.channelFilterInput))).filter((t=>o["a"].channelList.some((e=>t.id===e.id)))).map((t=>{const e=t.title.length>48?t.title.substring(0,44)+"...":t.title;return{label:e,title:t.title,caption:"%"+t.id,id:t.id}}))},submitReady(){if(this.channelImage&&!this.isChannelImageLoaded)return!1;if(this.channelImage&&!0!==this.rules.validateChannelImage(this.channelImage))return!1;if(this.postImage&&!this.isPostImageLoaded)return!1;if(this.postImage&&!0!==this.rules.validatePostImage(this.postImage))return!1;if(!this.rate)return!1;if(this.createChannel){if([this.rules.validateChannelTitle(this.channelTitle),this.rules.validateChannelDesc(this.channelDescription)].some((t=>!0!==t)))return!1}else if(!this.selectedChannel.id)return!1;return!![this.rules.validatePostTitle(this.postTitle),this.rules.validatePostDesc(this.postDescription),this.rules.validatePostUrl(this.abUrl)].every((t=>!0===t))}},methods:{todo(){this.$q.notify("TODO: This is not impl")},changeShow(t){this.$emit("input",t)},clear(){var t;const e={progressText:"",postTitle:"",titleFromTask:"",postDescription:"",postImage:"",isPostImageLoaded:!1,channelTitle:"",channelDescription:"",channelImage:"",isChannelImageLoaded:!1,abUrl:"",abSelect:null,magnetInput:"",showMagnetInput:!1,createChannel:!0,rate:this.rateOptions[0],taskOptions:[],channelFilterInput:"",selectedChannel:{label:"",title:"",id:""}};null!==(t=this.channelOptions)&&void 0!==t&&t.length&&(e.createChannel=!1,e.selectedChannel=this.channelOptions[0]);for(const s in e)this.$set(this,s,e[s])},getTaskOption(t){var e;const s=t.postTitle||t.name||t.infoHash,a=s.length>36?s.substring(0,32)+"...":s;let i=Object(n["f"])(t.progress||1);if(t.ready)i="100.00%";else if(t.verifyStatus){const{current:e,total:s}=t.verifyStatus,a=e/s,o=Object(n["f"])(a);isNaN(a)||(i=o)}const o=(null===(e=t.alphabizURI.split("&"))||void 0===e?void 0:e[0])||t.alphabizURI,r="ab://"+o.split("/").pop();return{label:t.ready?a:a+` (${i})`,title:s,progress:i,value:r,ready:t.ready}},filterOptions(t,e){const s=t.toLowerCase();e((()=>{this.taskOptions=this.uploadingTasks.filter((t=>t.title.toLowerCase().includes(s)))}))},selectTask(t){this.abUrl=t.value,this.postTitle?this.titleFromTask=t.title:this.postTitle=t.title,this.postDescription||(this.postDescription=this.$t("uploaded_by",{title:t.title,name:this.username})),this.channelTitle||(this.channelTitle=t.title),this.channelDescription||(this.channelDescription=this.$t("created_by",{title:t.title,name:this.username}))},filterChannels(t,e){const s=t.toLowerCase();e((()=>{this.channelFilterInput=s}))},updatePostImageState(t){this.isPostImageLoaded=1===t},updateChannelImageState(t){this.isChannelImageLoaded=1===t},showProgress(t,...e){console.log(this.$t("progress")+":",t,...e),this.progressText=t},async createNewChannel(){const t=await o["a"].createChannel(this.channelTitle.trim(),this.channelDescription.trim(),this.channelImage.trim());return console.log("Channel created",t),t},async submit(){let t=this.selectedChannel.id;if(this.createChannel){this.showProgress(this.$t("creating_new_channel")),await y(1e3);const e=await this.createNewChannel();this.showProgress(this.$t("created_new_channel"),e),await y(1e3),t=e.id}this.showProgress(this.$t("creating_new_post")),await y(1e3);const e=await o["a"].createPost({title:this.postTitle.trim(),description:this.postDescription.trim(),image:this.postImage.trim(),rate:this.rate.value,abUrl:this.abUrl.trim()},t);this.showProgress(this.$t("created_new_post"),e),await y(2e3),this.showProgress(""),await y(500),this.$emit("input",!1)},async askForConfirm(t,e){return new Promise((s=>{this.$q.dialog({title:t,message:e,ok:this.$t("ok"),cancel:this.$t("cancel")}).onOk((()=>s(!0))).onCancel((()=>s(!1)))}))},calcFileSize(t){return t.reduce(((t,e)=>t+e.size),0)},async onFileChange(t){var e,a;const i=null===t||void 0===t||null===(e=t.target)||void 0===e||null===(a=e.files)||void 0===a?void 0:a[0];if(i){if(console.log("file selected",i),t.target.value=null,i.size>b){const t=await this.askForConfirm(this.$t("file_too_large"),this.$t("file_too_large_msg",{size:Object(n["a"])(i.size)}));if(!t)return}if(Object(c["isElectron"])())this.createTask(i.path);else{const t=s("ac4e").wtClient;if(t.torrents.length){const e=await this.askForConfirm(this.$t("remove_old_task"),this.$t("remove_old_task_desc"));if(!e)return;t.torrents[0].destroy(),t.torrents.splice(0)}this.createTask(i)}}},async onFolderChange(t){var e,s,a;console.log("onFolderChange",t),(null===t||void 0===t||null===(e=t.target)||void 0===e||null===(s=e.files)||void 0===s?void 0:s.length)>100&&(this.showProgress(this.$t("resolving_folder_files")),await y(100));const i=[...null===t||void 0===t||null===(a=t.target)||void 0===a?void 0:a.files];if(!i)return;console.log("folder selected",i),t.target.value=null;const o=this.calcFileSize(i),r=h(i.map((t=>t.path)));if(this.showProgress(""),await y(50),o>b){const t=await this.askForConfirm(this.$t("folder_too_large"),this.$t("folder_too_large_msg",{size:Object(n["a"])(o)}));if(!t)return}console.log("TOTAL:",o),console.log("Create task with folder",r),this.createTask(r)},async createTask(t){const e=_();this.showProgress(this.$t("creating_new_task")),Object(c["isElectron"])()?Object(u["g"])(t,e):g["a"].emit("wt-add",t,{token:e});const s=()=>{const t=setInterval((()=>{const s=r["a"].taskList.uploading.find((t=>t.token===e)),a=()=>{this.showProgress(""),this.selectTask(this.getTaskOption(s))};if(s.ready&&s.alphabizURI)return clearInterval(t),void a();if(!s.verifyStatus)return this.showProgress(this.$t("loading")+"... (0%)");const i=Object(n["f"])(s.verifyStatus.current/s.verifyStatus.total);this.showProgress(this.$t("loading")+`... (${i})`),s.verifyStatus.current>=s.verifyStatus.total&&s.alphabizURI&&(clearInterval(t),setTimeout(a,1e3))}),1e3)},a=Date.now(),i=setInterval((()=>{const t=r["a"].taskList.uploading.find((t=>t.token===e));if(t)clearInterval(i),s();else if(Date.now()-a>3e3)return clearInterval(i),this.showProgress(""),this.askForConfirm(this.$t("cannot_create_task"),this.$t("cannot_create_task_msg"))}),500)},async fromMagnet(){if("string"!==typeof this.magnetInput||!this.magnetInput)return;if(!this.magnetInput.startsWith("magnet"))return this.$q.dialog({title:this.$t("invalid_download_url"),ok:this.$t("ok")});let t=this.magnetInput;if(!t.includes("dn=")){if(!this.postTitle)return this.$q.dialog({message:this.$t("magnet_does_not_have_name"),ok:this.$t("ok")});t+=`&dn=${encodeURIComponent(this.postTitle)}`}const e=await Object(f["a"])(t);if(!e)return this.$q.dialog({title:this.$t("invalid_download_url"),ok:this.$t("ok")});const s=t.split("&").find((t=>t.startsWith("dn="))),a=s?decodeURIComponent(s.substring(3)):this.postTitle;if(!a)return this.$q.dialog({title:this.$t("cannot_get_task_name"),ok:this.$t("ok")});this.selectTask({value:e,label:a,title:a})}},watch:{show(t){t&&this.$nextTick((()=>{this.clear(),this.preset&&this.selectTask(this.getTaskOption(this.preset))}))}}},C=w,$=(s("39a2"),s("2877")),k=s("24e8"),q=s("f09f"),x=s("a370"),S=s("9c40"),P=s("ddd8"),T=s("27f9"),I=s("3786"),O=s("66e5"),U=s("4074"),j=s("0170"),A=s("4b7e"),B=s("7f67"),L=s("eebe"),R=s.n(L),D=Object($["a"])(C,a,i,!1,null,"08fa5176",null);e["a"]=D.exports;R()(D,"components",{QDialog:k["a"],QCard:q["a"],QCardSection:x["a"],QBtn:S["a"],QSelect:P["a"],QInput:T["a"],QRadio:I["a"],QItem:O["a"],QItemSection:U["a"],QItemLabel:j["a"],QCardActions:A["a"]}),R()(D,"directives",{ClosePopup:B["a"]})},b68e:function(t,e,s){},bad3:function(t,e,s){"use strict";s("24f7")},c65d:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"image-with-preview full-width"},[s("q-input",{staticClass:"full-width",attrs:{outlined:"","stack-label":"",value:t.value,label:t.label,rules:t.rules,placeholder:"https://example.org/path/to/image.jpg",debounce:500},on:{input:t.emitSrc},nativeOn:{paste:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"after",fn:function(){return[s("div",{staticClass:"image-container"},[s("img",{staticClass:"preview-image",class:t.state,attrs:{src:t.value},on:{error:t.emitError,load:t.emitSuccess}}),"error"===t.state?s("q-icon",{attrs:{name:"close",size:"56px",color:"red"}},[s("q-tooltip",[t._v(t._s(t.$t("invalid_image")))])],1):t._e(),"loading"===t.state?s("q-icon",{attrs:{name:"image",size:"56px",color:"green"}},[s("q-tooltip",[t._v(t._s(t.$t("poster")))])],1):t._e()],1)]},proxy:!0}])})],1)},i=[],n={props:{value:String,label:String,rules:{type:Array,default:()=>[]}},data(){return{state:"loading"}},methods:{emitSrc(t){this.$emit("input",t)},emitError(){""!==this.value&&(this.$emit("state",2),this.state="error")},emitSuccess(){this.$emit("state",1),this.state="loaded"}},watch:{value(){console.log("src change"),this.$emit("state",0),this.state="loading"}}},o=n,r=(s("d334"),s("2877")),l=s("27f9"),c=s("0016"),d=s("05c0"),h=s("eebe"),u=s.n(h),p=Object(r["a"])(o,a,i,!1,null,"95eae78e",null);e["a"]=p.exports;u()(p,"components",{QInput:l["a"],QIcon:c["a"],QTooltip:d["a"]})},cb5e:function(t,e,s){"use strict";s("9c81")},cc54:function(t,e,s){"use strict";s("feb4")},cdb1:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-footer",{attrs:{bordered:""}},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.disable,expression:"!disable"}],staticClass:"row q-pa-sm"},[s("q-btn",{staticClass:"q-mx-xs",attrs:{unelevated:"",loading:t.loading,"text-color":"primary",color:"primary",label:t.$t("submit")},on:{click:t.submit}}),s("q-btn",{staticClass:"q-mx-xs",attrs:{unelevated:"",loading:t.loading,"text-color":"general",color:"general",label:t.$t("discard")},on:{click:t.discard}}),s("q-space"),s("q-btn",{staticClass:"q-mx-xs",attrs:{unelevated:"",loading:t.loading,"text-color":"negative",color:"negative",label:t.$t("reset")},on:{click:t.reset}})],1)])},i=[],n={props:{disable:Boolean,loading:Boolean},methods:{submit(){this.$emit("submit")},discard(){this.$emit("discard")},reset(){this.$emit("reset")}}},o=n,r=s("2877"),l=s("7ff0"),c=s("9c40"),d=s("2c91"),h=s("eebe"),u=s.n(h),p=Object(r["a"])(o,a,i,!1,null,null,null);e["a"]=p.exports;u()(p,"components",{QFooter:l["a"],QBtn:c["a"],QSpace:d["a"]})},d334:function(t,e,s){"use strict";s("b2bc")},d360:function(t,e,s){},d491:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.torrent?s("q-dialog",{staticClass:"detail-dialog",attrs:{value:t.show},on:{input:t.closeDialog}},[s("q-card",{staticClass:"detail-dialog"},[s("q-card-section",[s("div",{staticClass:"text-h6 ellipsis"},[t.torrent.fromPost?s("q-icon",{staticClass:"q-mr-xs text-primary",attrs:{name:"video_library"}},[s("q-tooltip",[t._v("\n            "+t._s(t.$t("library"))+"\n          ")])],1):t._e(),s("span",{attrs:{title:t.torrent.postTitle||t.torrent.name}},[t._v("\n          "+t._s(t.torrent.postTitle||t.torrent.name)+"\n        ")])],1),s("q-input",{attrs:{readonly:"",label:t.$t("download")+" URL"},scopedSlots:t._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer text-h4",attrs:{name:"content_copy"},on:{click:t.copyMagnetURI}},[s("q-tooltip",[t._v(t._s(t.$t("copy_download_uri")))])],1),s("IconWithTooltip",{attrs:{icon:"share",tooltip:t.$t("copy_share_uri"),clickable:!0},on:{click:t.copyShortURI}})]},proxy:!0}],null,!1,1430967626),model:{value:t.downloadURI,callback:function(e){t.downloadURI=e},expression:"downloadURI"}})],1),t.fileTree.length?s("q-card-section",{staticClass:"q-py-none"},[s("div",{staticClass:"title"},[t.isElectron?s("q-btn",{attrs:{flat:"",dense:"",size:"sm"},on:{click:t.showDirectory}},[s("IconWithTooltip",{attrs:{icon:"folder_open",tooltip:t.$t("open_directory"),clickable:""}})],1):t._e(),t._v("\n        "+t._s(t.$t("files"))+":\n      ")],1),s("q-tree",{staticClass:"no-select file-tree",attrs:{nodes:t.fileTree,"node-key":"label",dense:"","no-connectors":""},scopedSlots:t._u([{key:"default-header",fn:function(e){return[s("q-item",{staticClass:"text full-width q-py-none q-px-xs no-margin vertical-middle",class:{"no-path":!e.node.path},attrs:{dense:"",clickable:!e.node.children},on:{dblclick:function(s){return t.onDblClick(e.node)}}},[!e.node.children&&e.node.path?s("IconWithTooltip",t._b({staticClass:"q-mt-xs q-mr-xs"},"IconWithTooltip",t.getFileIcon(e.node.path),!1)):e.node.path?s("IconWithTooltip",{staticClass:"q-mt-xs q-mr-xs",attrs:{icon:"folder"}}):t._e(),e.node.progress?s("span",{staticClass:"file-progress"},[t._v(t._s(e.node.progress))]):t._e(),s("span",{staticClass:"file-name"},[t._v("‎"+t._s(e.node.label))])],1)]}}],null,!1,3812602171)})],1):t._e(),s("q-card-section",{staticClass:"peers"},[s("q-expansion-item",{attrs:{"expand-separator":"",icon:"people",label:"Peers ("+t.connectedPeers.length+")",value:!0}},[s("q-markup-table",{staticClass:"peer-table q-px-sm",attrs:{flat:"",dense:""}},[s("thead",[s("tr",[s("th",{staticClass:"text-center"}),s("th",{staticClass:"text-left ip",staticStyle:{"padding-left":"32px"}},[t._v("Peer")]),t.isDevMode?s("th",{staticClass:"text-left client"},[t._v(t._s(t.$t("client")))]):t._e(),s("th",{staticClass:"text-right"},[t._v(t._s(t.$t("total_download_speed")))]),s("th",{staticClass:"text-right"},[t._v(t._s(t.$t("total_upload_speed")))]),s("th",{staticClass:"text-right"},[t._v(t._s(t.$t("progress")))])])]),s("tbody",t._l(t.connectedPeers,(function(e){return s("PeerInfo",{key:e.id,attrs:{peer:e},on:{showPaymentPannel:t.showPaymentPannel}})})),1)])],1)],1),s("q-card-section",{staticClass:"q-pt-none"},[s("q-expansion-item",{directives:[{name:"show",rawName:"v-show",value:t.trackerList.length,expression:"trackerList.length"}],attrs:{icon:"dns",label:"Trackers ("+t.trackerList.length+")"}},[t.isElectron?s("div",{staticClass:"row justify-end q-pa-sm"},[s("q-input",{staticClass:"col",attrs:{dense:"",type:"text",label:"Tracker URL"},nativeOn:{paste:function(t){t.stopPropagation()}},model:{value:t.newTrackerUrl,callback:function(e){t.newTrackerUrl=e},expression:"newTrackerUrl"}}),s("q-btn",{attrs:{dense:"",color:"primary q-mx-sm q-px-sm",icon:"add",label:t.$t("add")},on:{click:t.addTracker}})],1):t._e(),s("q-markup-table",{staticClass:"tracker-table q-px-sm",attrs:{flat:"",dense:""}},[s("thead",[s("tr",[s("th",{staticClass:"text-left",staticStyle:{"padding-left":"40px"}},[t._v("URL")]),s("th",{staticClass:"text-left"},[t._v(t._s(t.$t("status")))]),s("th",{staticClass:"text-right"},[t._v(t._s(t.$t("last_update")))]),s("th",{staticClass:"text-center"},[t._v(t._s(t.$t("seeders")))]),s("th",{staticClass:"text-center"},[t._v("Peers")]),t.isElectron?s("th"):t._e()])]),s("tbody",t._l(t.trackerList,(function(e){return s("tr",{key:e.url},[s("td",{staticClass:"text-left url",attrs:{title:e.displayUrl+(e.isIpv6?" (IPv6)":"")}},[e.isIpv6?s("IconWithTooltip",{staticStyle:{color:"#4697ec"},attrs:{icon:"looks_6",tooltip:"IPv6",size:"xs"}}):s("q-icon",{attrs:{name:"looks_4",color:"grey",size:"xs"}}),t._v("\n                "+t._s(e.displayUrl)+"\n              ")],1),s("td",{staticClass:"text-left status",attrs:{title:e.status}},[t._v(t._s(e.status))]),s("td",{staticClass:"text-right"},[t._v(t._s(e.time))]),s("td",{staticClass:"text-center"},[t._v(t._s(e.complete))]),s("td",{staticClass:"text-center"},[t._v(t._s(e.incomplete))]),t.isElectron?s("td",{staticClass:"text-center"},[s("q-btn",{attrs:{color:"red",icon:"close",size:"xs",dense:"",flat:""},on:{click:function(s){return t.removeTracker(e.url)}}})],1):t._e()])})),0)])],1)],1)],1)],1):t._e()},i=[],n=(s("26e9"),s("5319"),s("ddb0"),s("498a"),s("cdde")),o=s("f880"),r=s("51d9"),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("tr",[s("td",{staticClass:"status text-center"},[t.peer.isAbPeer?"high"===t.peer.level?s("q-icon",{attrs:{name:"done_all"}},[s("q-tooltip",[t._v(t._s(t.$t("ab_peer_verified")))])],1):s("q-icon",{attrs:{name:"done"}},[s("q-tooltip",[t._v(t._s(t.$t("ab_peer")))])],1):s("q-icon",{attrs:{name:"remove"}},[s("q-tooltip",[t._v(t._s(t.$t("common_peer")))])],1)],1),s("td",{staticClass:"addresses"},t._l(t.peer.addresses,(function(e){return s("div",{key:t.peer.id+"_"+e,staticClass:"self-center not-outline address"},[s("q-icon",{attrs:{name:t.peer.secure?"lock":"lock_open",size:"xs",color:t.peer.secure?"green":"grey"}},[s("q-tooltip",[t._v(t._s(t.peer.secure?t.$t("encrypted_connection"):t.$t("non_encrypted_connection")))])],1),s("span",{staticClass:"country-flag q-ml-sm",attrs:{title:t.country}},[t._v(t._s(t.countryFlag))]),t.isDevMode?s("span",{staticClass:"q-ml-xs"},[t._v(t._s(e))]):s("span",{staticClass:"q-ml-xs"},[t._v(t._s(e?e.substring(0,4)+"*":"-"))])],1)})),0),t.isDevMode?s("td",{staticClass:"client text-left",class:{"text-primary":"Alphabiz"===t.peerClient},attrs:{title:t.peerClient}},[t._v(t._s(t.peerClient))]):t._e(),s("td",{staticClass:"text-right",class:{"text-primary":t.peer.downloadSpeed}},[t._v(t._s(t.downloadSpeed)+" / s")]),s("td",{staticClass:"text-right",class:{"text-primary":t.peer.uploadSpeed}},[t._v(t._s(t.uploadSpeed)+" / s")]),s("td",{staticClass:"progress text-right"},[t._v(t._s(t.peerProgress))])])},c=[],d=s("64f1"),h=d["a"],u=(s("cc54"),s("2877")),p=s("0016"),m=s("05c0"),f=s("eebe"),g=s.n(f),v=Object(u["a"])(h,l,c,!1,null,"3bfc5956",null),b=v.exports;g()(v,"components",{QIcon:p["a"],QTooltip:m["a"]});var y=s("307e"),_=s("9649"),w=s("0613"),C={props:{show:{type:Boolean,default:!1},torrent:{type:Object,required:!0}},data(){const t=Object(_["a"])()?s("bdb9").ipcRenderer:{};return{newTrackerUrl:"",isElectron:Object(_["a"])(),ipcRenderer:t}},components:{IconWithTooltip:r["a"],PeerInfo:b},inject:["io"],computed:{isDevMode(){return w["a"].getters.isDevMode},fileCount(){if(!this.torrent)return 0;const t=this.torrent.files||this.torrent.file||[];return t&&t.length?t.length:0},fileTree(){if(!this.torrent)return[];const t=this.torrent.files&&this.torrent.files.map?this.torrent.files.map((t=>t.path)):this.torrent.file||[];if(!t||!t.length)return[];const e=this.fileCount>21?t.slice(t.length-20):t,s=Object(o["b"])(e,this.torrent.files);return s?(this.fileCount>21&&s.children&&s.children.push({label:this.$t("more_files_are_not_shown",[this.fileCount-20])}),[s]):[]},downloadURI(){return this.torrent.alphabizURI?this.torrent.alphabizURI:this.torrent.magnetURI},trackerList(){if(!this.torrent.trackerList)return[];const t=this.torrent.trackerList.map((t=>{const e=this.trackerStatus(t.message||t.status),s=t.info||{complete:"-",incomplete:"-"},a=new Date(t.timestamp),i=[a.getHours(),a.getMinutes(),a.getSeconds()].map((t=>("00"+t).slice(-2))).join(":");return{url:t.url,displayUrl:t.url.replace("@6",""),status:e,time:i,isIpv6:t.isIpv6,...s}})).reverse();return Object(_["a"])()?t:t.filter((t=>{var e;return null===(e=t.url)||void 0===e?void 0:e.startsWith("ws")}))},connectedPeers(){if(!this.torrent||!this.torrent.connections)return[];const t={};for(const a of this.torrent.connections){const e=a.id;t[e]||(t[e]={...a},t[e].addresses=[],t[e].uploadSpeed=0,t[e].downloadSpeed=0,t[e].downloaded=0),t[e].addresses.includes(a.address)||t[e].addresses.push(a.address),t[e].uploadSpeed+=a.uploadSpeed,t[e].downloadSpeed+=a.downloadSpeed,t[e].downloaded+=a.downloaded,t[e].isAbPeer|=a.isAbPeer,t[e].isPayed|="high"===a.remoteGroup,t[e].secure|=a.secure}const e=[],s=Object.values(t).sort(((t,e)=>{var s;return null!==(s=t.id)&&void 0!==s&&s.localeCompare?t.id.localeCompare(e.id):0})).filter((t=>!!t.id&&(!e.includes(t.id)&&(e.push(t.id),!0))));return s}},methods:{getFileIcon(t){const e=Object(o["c"])([t]);return{icon:e.icon,tooltip:this.$t(e.tooltip)}},closeDialog(){this.$emit("close")},copyToClipboard(t){Object(n["a"])(t).then((()=>{this.$q.notify(this.$t("uri_copied"))})).catch((()=>{this.$q.notify(this.$t("uri_copy_failed"))}))},copyMagnetURI(){this.copyToClipboard(this.downloadURI)},copyShortURI(){if(!this.torrent.alphabizURI)return;const t=this.torrent.alphabizURI.match(/[^:/]\/([^&/]+)&/);t&&t[1]&&this.copyToClipboard("ab://"+t[1])},showPaymentPannel(t){this.$emit("showPaymentPannel",Object.assign({infoHash:this.torrent.infoHash,name:this.torrent.name},t))},showDirectory(){this.$emit("showDirectory",this.torrent)},onDblClick(t){console.log(t),t.children||(Object(y["a"])(t.label)?this.$emit("play",t.path,this.torrent.infoHash):t.path&&this.io.emit("open-external-file",t.path))},trackerStatus(t){const e=t.toLowerCase();return"connecting"===e?this.$t("connecting"):"updated"===e?this.$t("connected"):e.includes("timed out")?this.$t("request_timed_out"):e.includes("connection failed")?this.$t("connection_failed"):this.$t("unknown_error",[t])},addTracker(){console.log("add",this.newTrackerUrl,this.torrent.infoHash);const t=this.newTrackerUrl.trim();if(this.torrent.trackerList.find((e=>e.url===t)))return this.$q.notify(this.$t("duplicate_tracker"));this.isElectron&&this.ipcRenderer.send("add-tracker",{infoHash:this.torrent.infoHash,url:t}),this.newTrackerUrl=""},removeTracker(t){console.log("remove",t,this.torrent.infoHash),this.isElectron&&this.ipcRenderer.send("remove-tracker",{infoHash:this.torrent.infoHash,url:t})}}},$=C,k=(s("0c77"),s("24e8")),q=s("f09f"),x=s("a370"),S=s("27f9"),P=s("9c40"),T=s("7f41"),I=s("66e5"),O=s("3b73"),U=s("2bb1"),j=Object(u["a"])($,a,i,!1,null,"658860d8",null);e["a"]=j.exports;g()(j,"components",{QDialog:k["a"],QCard:q["a"],QCardSection:x["a"],QIcon:p["a"],QTooltip:m["a"],QInput:S["a"],QBtn:P["a"],QTree:T["a"],QItem:I["a"],QExpansionItem:O["a"],QMarkupTable:U["a"]})},db60:function(t,e,s){},e061:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"show",rawName:"v-show",value:!t.electronOnly||t.isElectron,expression:"electronOnly ? isElectron : true"}],staticClass:"setting-block row q-mt-md q-mb-lg"},[s("div",{staticClass:"setting-label col-xs-12 col-sm-4 q-pt-sm"},[s("span",{staticClass:"q-mr-md"},[t._v(t._s(t.label))])]),s("div",{staticClass:"setting-content col row"},[t._t("default")],2)])},i=[],n=s("ed08"),o={props:{label:String,electronOnly:Boolean},data(){return{isElectron:Object(n["isElectron"])()}}},r=o,l=(s("5db0"),s("2877")),c=Object(l["a"])(r,a,i,!1,null,"937008c6",null);e["a"]=c.exports},e38a:function(t,e,s){"use strict";s("f05f")},ea83:function(t,e,s){"use strict";s("48e1")},f05f:function(t,e,s){},feb4:function(t,e,s){}}]);